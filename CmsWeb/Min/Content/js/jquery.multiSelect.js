jQuery&&function(n){function e(n,t){var i='<label><input type="checkbox" name="'+n+'" value="'+t.value+'"';return t.selected&&(i+=' checked="checked"'),i+=" />"+t.text+"</label>"}function f(n,t,i){for(var u="",r=0;r<t.length;r++)t[r].optgroup?(u+='<label class="optGroup">',u+=i.optGroupSelectable?'<input type="checkbox" class="optGroup" />'+t[r].optgroup:t[r].optgroup,u+='</label><div class="optGroupContainer">',u+=f(n,t[r].options,i),u+="</div>"):u+=e(n,t[r]);return u}function r(r){var o=n(this),e=o.next(".multiSelectOptions"),s=o.data("config"),c=o.data("callback"),h,v,l,a;e.html(""),h="",s.selectAll&&(h+='<label class="selectAll"><input type="checkbox" class="selectAll" />'+s.selectAllText+"</label>"),h+=f(o.attr("id"),r,s),e.html(h),v=e.width(),l=!1,e.height()>s.listHeight?(e.css("height",s.listHeight+"px"),l=!0):e.css("height",""),a=l&&v==e.width()?17:0,e.width()+a<o.outerWidth()?e.css("width",o.outerWidth()-2+"px"):e.css("width",e.width()+a+"px"),n.fn.bgiframe&&o.next(".multiSelectOptions").bgiframe({width:e.width(),height:e.height()}),s.selectAll&&e.find("INPUT.selectAll").click(function(){e.find("INPUT:checkbox").attr("checked",n(this).attr("checked")).parent("LABEL").toggleClass("checked",n(this).attr("checked"))}),s.optGroupSelectable&&(e.addClass("optGroupHasCheckboxes"),e.find("INPUT.optGroup").click(function(){n(this).parent().next().find("INPUT:checkbox").attr("checked",n(this).attr("checked")).parent("LABEL").toggleClass("checked",n(this).attr("checked"))})),e.find("INPUT:checkbox").click(function(){n(this).parent("LABEL").toggleClass("checked",n(this).attr("checked")),t.call(o),o.focus(),n(this).parent().parent().hasClass("optGroupContainer")&&i.call(o,n(this).parent().parent().prev()),c&&c(n(this))}),e.each(function(){n(this).find("INPUT:checked").parent().addClass("checked")}),t.call(o),s.optGroupSelectable&&e.find("LABEL.optGroup").each(function(){i.call(o,n(this))}),e.find("LABEL:has(INPUT)").hover(function(){n(this).parent().find("LABEL").removeClass("hover"),n(this).addClass("hover")},function(){n(this).parent().find("LABEL").removeClass("hover")}),o.keydown(function(i){var r=n(this).next(".multiSelectOptions"),e;if(r.css("visibility")!="hidden"){if(i.keyCode==9)return n(this).addClass("focus").trigger("click"),n(this).focus().next(":input").focus(),!0;if((i.keyCode==27||i.keyCode==37||i.keyCode==39)&&n(this).addClass("focus").trigger("click"),i.keyCode==40||i.keyCode==38){var h=r.find("LABEL"),s=h.index(h.filter(".hover")),l=-1;return s<0?r.find("LABEL:first").addClass("hover"):i.keyCode==40&&s<h.length-1?l=s+1:i.keyCode==38&&s>0&&(l=s-1),l>=0&&(n(h.get(s)).removeClass("hover"),n(h.get(l)).addClass("hover"),u(r)),!1}if(i.keyCode==13||i.keyCode==32)return e=r.find("LABEL.hover INPUT:checkbox"),e.attr("checked",!e.attr("checked")).parent("LABEL").toggleClass("checked",e.attr("checked")),e.hasClass("selectAll")&&r.find("INPUT:checkbox").attr("checked",e.attr("checked")).parent("LABEL").addClass("checked").toggleClass("checked",e.attr("checked")),t.call(o),c&&c(n(this)),!1;if(i.keyCode>=33&&i.keyCode<=126){var f=r.find("LABEL:startsWith("+String.fromCharCode(i.keyCode)+")"),v=f.index(f.filter("LABEL.hover")),a=f.filter(function(n){return n>v});f=(a.length>=1?a:f).filter("LABEL:first"),f.length==1&&(r.find("LABEL.hover").removeClass("hover"),f.addClass("hover"),u(r))}}else{if(i.keyCode==38||i.keyCode==40||i.keyCode==13||i.keyCode==32)return n(this).removeClass("focus").trigger("click"),r.find("LABEL:first").addClass("hover"),!1;if(i.keyCode==9)return r.next(":input").focus(),!0}if(i.keyCode==13)return!1})}function u(n){var t=n.find("LABEL.hover").position().top+n.find("LABEL.hover").outerHeight();t>n.innerHeight()&&n.scrollTop(n.scrollTop()+t-n.innerHeight()),n.find("LABEL.hover").position().top<0&&n.scrollTop(n.scrollTop()+n.find("LABEL.hover").position().top)}function i(t){var r=n(this),u=r.data("config"),i;u.optGroupSelectable&&(i=!0,n(t).next().find("INPUT:checkbox").each(function(){if(!n(this).attr("checked"))return i=!1,!1}),n(t).find("INPUT.optGroup").attr("checked",i).parent("LABEL").toggleClass("checked",i))}function t(){var i=n(this),e=i.next(".multiSelectOptions"),r=i.data("config"),f=0,u=!0,t="";e.find("INPUT:checkbox").not(".selectAll, .optGroup").each(function(){n(this).attr("checked")?(f++,t=t+n(this).parent().text()+", "):u=!1}),t=t.replace(/\s*\,\s*$/,""),f==0?i.find("span").html(r.noneSelected):r.oneOrMoreSelected=="*"?(i.find("span").html(t),i.attr("title",t)):i.find("span").html(r.oneOrMoreSelected.replace("%",f)),r.selectAll&&e.find("INPUT.selectAll").attr("checked",u).parent("LABEL").toggleClass("checked",u)}n.extend(n.fn,{multiSelect:function(t,i){t||(t={}),t.selectAll==undefined&&(t.selectAll=!0),t.selectAllText==undefined&&(t.selectAllText="Select All"),t.noneSelected==undefined&&(t.noneSelected="Select options"),t.oneOrMoreSelected==undefined&&(t.oneOrMoreSelected="% selected"),t.optGroupSelectable==undefined&&(t.optGroupSelectable=!1),t.listHeight==undefined&&(t.listHeight=150),n(this).each(function(){var f=n(this),o='<a href="javascript:;" class="multiSelect"><span></span></a>',u,s,e;o+='<div class="multiSelectOptions" style="position: absolute; z-index: 99999; visibility: hidden;"></div>',n(f).after(o),u=n(f).next(".multiSelect"),s=u.next(".multiSelectOptions"),u.find("span").css("width",n(f).width()+"px"),u.data("config",t),u.data("callback",i),e=[],n(f).children().each(function(){if(this.tagName.toUpperCase()=="OPTGROUP"){var t=[];e.push({optgroup:n(this).attr("label"),options:t}),n(this).children("OPTION").each(function(){n(this).val()!=""&&t.push({text:n(this).html(),value:n(this).val(),selected:n(this).attr("selected")})})}else this.tagName.toUpperCase()=="OPTION"&&n(this).val()!=""&&e.push({text:n(this).html(),value:n(this).val(),selected:n(this).attr("selected")})}),n(f).remove(),u.attr("id",n(f).attr("id")),r.call(u,e),u.hover(function(){n(this).addClass("hover")},function(){n(this).removeClass("hover")}).click(function(){return n(this).hasClass("active")?n(this).multiSelectOptionsHide():n(this).multiSelectOptionsShow(),!1}).focus(function(){n(this).addClass("focus")}).blur(function(){n(this).removeClass("focus")}),n(document).click(function(t){n(t.target).parents().andSelf().is(".multiSelectOptions")||u.multiSelectOptionsHide()})})},multiSelectOptionsUpdate:function(t){r.call(n(this),t)},multiSelectOptionsHide:function(){n(this).removeClass("active").removeClass("hover").next(".multiSelectOptions").css("visibility","hidden")},multiSelectOptionsShow:function(){var t=n(this),r=t.next(".multiSelectOptions"),u=t.data("config"),i;n(".multiSelect").multiSelectOptionsHide(),r.find("LABEL").removeClass("hover"),t.addClass("active").next(".multiSelectOptions").css("visibility","visible"),t.focus(),t.next(".multiSelectOptions").scrollTop(0),i=t.position(),t.next(".multiSelectOptions").css({top:i.top+n(this).outerHeight()+"px"}),t.next(".multiSelectOptions").css({left:i.left+"px"})},selectedValuesString:function(){var t="";return n(this).next(".multiSelectOptions").find("INPUT:checkbox:checked").not(".optGroup, .selectAll").each(function(){t+=n(this).attr("value")+","}),t.replace(/\s*\,\s*$/,"")}}),n.expr[":"].startsWith=function(t,i,r){var u=r[3];return u?eval("/^[/s]*"+u+"/i").test(n(t).text()):!1}}(jQuery)