(function(n){n.fn.checkboxTree=function(t){t=n.extend({collapsedarrow:"img-arrow-collapsed.gif",expandedarrow:"img-arrow-expanded.gif",blankarrow:"img-arrow-blank.gif",activeClass:"checkboxtreeactive",hoverClass:"over",checkchildren:!1,checkparents:!0,collapsed:!0,hidecbwithjs:!1,checkedClass:"checked"},t);var i=this,u=n(":checkbox + label",i),r=n(":checkbox",i);return n("li",i).each(function(){var r=n(this),i,f,u;t.checkparents&&(f=n("ul li input:checked",r).length,u=r.children("input:checkbox:first"),!r.children("input:checkbox:first").is(":checked")&&f>0&&u.attr("checked","checked")),r.is(":has(ul)")?t.collapsed?(r.find("ul").hide(),i=n('<img class="checkboxtreeimage" src="'+t.collapsedarrow+'" / >'),i.data("collapsedstate",0)):(i=n('<img class="checkboxtreeimage" src="'+t.expandedarrow+'" / >'),i.data("collapsedstate",1)):i=n('<img src="'+t.blankarrow+'" / >'),r.prepend(i)}),i.addClass(t.activeClass),i.bind("click.checkboxtree",function(i,r){var u=n(i.target),c=u.prev(),f=u.parents("li:first"),h=f.parents("li:first").find(":checkbox:first"),a=h.next("label"),l=!1,o=!1,s,e;u.is(":checkbox + label")&&(l=!0),u.is("img.checkboxtreeimage")&&(o=!0),l&&(u.prev().attr({checked:!c.attr("checked")}).end().toggleClass(t.checkedClass),t.checkparents&&(s=n("input:checked",f).length,!h.is(":checked")&&s>0&&a.trigger("click.checkboxtree",["checkparents"])),t.checkchildren&&r!=="checkparents"&&f.find(":checkbox + label").prev().attr({checked:c.attr("checked")?"checked":""}).next().addClass(u.hasClass(t.checkedClass)?t.checkedClass:"").removeClass(u.hasClass(t.checkedClass)?"":t.checkedClass)),o&&(e=u.data("collapsedstate"),e===0?(f.children("ul").show(),f.children("img").attr("src",t.expandedarrow),u.data("collapsedstate",1)):e===1&&(f.children("ul").hide(),f.children("img").attr("src",t.collapsedarrow),u.data("collapsedstate",0)))}),n("input:checked + label",i).addClass(t.checkedClass),n.browser.msie&&n.browser.version<7&&u.hover(function(){n(this).addClass(t.hoverClass)},function(){n(this).removeClass(t.hoverClass)}),t.hidecbwithjs&&r.hide(),i}})(jQuery)