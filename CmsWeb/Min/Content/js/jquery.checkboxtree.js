(function(n){n.fn.checkboxTree=function(t){t=n.extend({collapsedarrow:"img-arrow-collapsed.gif",expandedarrow:"img-arrow-expanded.gif",blankarrow:"img-arrow-blank.gif",activeClass:"checkboxtreeactive",hoverClass:"over",checkchildren:!1,checkparents:!0,collapsed:!0,hidecbwithjs:!1,checkedClass:"checked"},t);var i=this,r=n(":checkbox + label",i),u=n(":checkbox",i);return n("li",i).each(function(){var i=n(this),r,u,f;t.checkparents&&(u=n("ul li input:checked",i).length,f=i.children("input:checkbox:first"),!i.children("input:checkbox:first").is(":checked")&&u>0&&f.attr("checked","checked")),i.is(":has(ul)")?t.collapsed?(i.find("ul").hide(),r=n('<img class="checkboxtreeimage" src="'+t.collapsedarrow+'" / >'),r.data("collapsedstate",0)):(r=n('<img class="checkboxtreeimage" src="'+t.expandedarrow+'" / >'),r.data("collapsedstate",1)):r=n('<img src="'+t.blankarrow+'" / >'),i.prepend(r)}),i.addClass(t.activeClass),i.bind("click.checkboxtree",function(i,r){var u=n(i.target),o=u.prev(),f=u.parents("li:first"),s=f.parents("li:first").find(":checkbox:first"),a=s.next("label"),h=!1,c=!1,l,e;u.is(":checkbox + label")&&(h=!0),u.is("img.checkboxtreeimage")&&(c=!0),h&&(u.prev().attr({checked:!o.attr("checked")}).end().toggleClass(t.checkedClass),t.checkparents&&(l=n("input:checked",f).length,!s.is(":checked")&&l>0&&a.trigger("click.checkboxtree",["checkparents"])),t.checkchildren&&r!=="checkparents"&&f.find(":checkbox + label").prev().attr({checked:o.attr("checked")?"checked":""}).next().addClass(u.hasClass(t.checkedClass)?t.checkedClass:"").removeClass(u.hasClass(t.checkedClass)?"":t.checkedClass)),c&&(e=u.data("collapsedstate"),e===0?(f.children("ul").show(),f.children("img").attr("src",t.expandedarrow),u.data("collapsedstate",1)):e===1&&(f.children("ul").hide(),f.children("img").attr("src",t.collapsedarrow),u.data("collapsedstate",0)))}),n("input:checked + label",i).addClass(t.checkedClass),n.browser.msie&&n.browser.version<7&&r.hover(function(){n(this).addClass(t.hoverClass)},function(){n(this).removeClass(t.hoverClass)}),t.hidecbwithjs&&u.hide(),i}})(jQuery)