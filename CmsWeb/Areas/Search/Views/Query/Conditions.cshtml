@using System.Web.UI.WebControls
@using CmsWeb.Areas.Search.Models
@model CmsWeb.Areas.Search.Models.QueryModel

@{
    var editing = false;
}
<div id="conditions">
    @Html.Hidden("AutoRun")
    @Html.Hidden("NewSearchId")

    <table id="conditionlist" class="table-striped">
        @if (ViewBag.NewSearch == null)
        {
            foreach (var c in Model.ConditionList())
            {
            <tr qid="@c.Clause.QueryId" class="condition">
                <td class="clausetext">
                    <a href='#' class="editconditionlink" style="padding-left: @(4 + c.Level * 13)px">
                        @if (Model.SelectedId == c.Clause.QueryId)
                        {
                            editing = true;
                            Model.EditCondition();
                            <div id="editconditionplaceholder" class="clausetext">@c.Clause</div>
                        }
                        else
                        {
                            <div class="clausetext">
                                @if (c.Clause.IsGroup)
                                {
                                    <b>@c.Clause</b>
                                }
                                else
                                {
                                    @c.Clause
                                }
                                &nbsp;<i class="icon-pencil"></i>
                            </div>
                        }
                    </a>
                </td>
                <td class="add-condition">
                    <div class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-plus"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            @if (c.Clause.IsGroup)
                            {
                                <li><a href="#" class="addnewclause">Add a new Group and Starting Condition to this Group</a></li>
                            }
                            else
                            {
                                <li><a href="#" class="addnewclause">Add a New Condition after this one</a></li>
                            }
                            @if (!c.Clause.IsFirst)
                            {
                                <li><a href="#" class="duplicateclause">@(c.Clause.IsGroup ? "Add a Group at the same level as this group" : "Duplicate This Condition")</a></li>
                            }
                            <li><a href="#" class="insgroupabove">Insert a new Group above this</a></li>
                            @if (c.Clause.Parent != null && c.Clause.Parent.Parent != null)
                            {
                                <li><a href="#" class="movetoprevgroup">Move to Higher Level Group</a></li>
                            }
                        </ul>
                    </div>
            </tr>
            }
        }
    </table>
    <div class="row-fluid">
        <div class="span6">
            <a href="/Query/NewQuery" class="btn btn-success pull-right">New</a>
            <a href="/SavedQuery2" class="btn pull-right">Saved</a>
        </div>
        <div class="span6">
            <a id="Run@(editing ? "1" : "")"class="btn btn-primary pull-right"><i class="icon-play"></i></a>
        </div>
    </div>
    @if (editing)
    {
        @Html.Partial("EditCondition", Model)
    }
</div>
