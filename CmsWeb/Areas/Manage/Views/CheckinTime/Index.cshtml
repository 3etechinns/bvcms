@using CmsWeb;
@using UtilityExtensions;
@model CmsWeb.Models.CheckinTimeModel
@{
	ViewBag.Title = "Check-in Activity";
	Layout = ViewExtensions2.TouchPointLayout();

    var at = Model.AccessTypes();
    var atd = Model.AccessTypes(true);
}
<h2>Check-in Activity</h2>
<form id="form" method="post" action="/CheckinTimes">
    <div class="row">
        <div class="col-md-9">
            @Html.Hidden("peopleid")
            <div class="well">
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <label for="namesearch">Name Search</label>
                            @Html.TextBox("namesearch", Model.namesearch, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <label for="dateStart">Start Date</label>
                            <div class="input-group date">
                                @Html.TextBox("dateStart", Model.dateStart.HasValue ? Model.dateStart.GetValueOrDefault().ToShortDateString() : "", new { @class = "form-control" })<span class="input-group-addon hidden-xs hidden-sm"><i class="fa fa-calendar"></i></span>
                                @Html.Hidden("dateStartIso", Model.dateStart.HasValue ? Model.dateStart.GetValueOrDefault().ToString("yyyy-MM-dd") : "", new { disabled = "disabled" })
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <label for="dateEnd">End Date</label>
                            <div class="input-group date">
                                @Html.TextBox("dateEnd", Model.dateEnd.HasValue ? Model.dateEnd.GetValueOrDefault().ToShortDateString() : "", new { @class = "form-control" })<span class="input-group-addon hidden-xs hidden-sm"><i class="fa fa-calendar"></i></span>
                                @Html.Hidden("dateEndIso", Model.dateEnd.HasValue ? Model.dateEnd.GetValueOrDefault().ToString("yyyy-MM-dd") : "", new { disabled = "disabled" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <label for="location">Location</label>
                            @Html.DropDownList("location", new SelectList(Model.Locations()), new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <label for="activity">Activity</label>
                            @Html.DropDownList("activity", new SelectList(Model.Activities()), new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-4">
                        <div class="form-group">
                            <label for="accesstype">Access Type</label>
                            <select name="accesstype" id="accesstype" class="form-control">
                                @for (var iX = 0; iX < atd.Count(); iX++)
                                {
                                    <option value="@iX" @(Model.accesstype == iX ? "selected=selected" : "")>@atd[iX]</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-4">

                    </div>
                    <div class="col-lg-3 col-lg-offset-6 col-md-3 col-md-offset-6 col-sm-4 col-sm-offset-4">
                        <div class="pull-right">
                            <a id="clear" href="#" class="btn btn-default">Clear</a> <a id="filter" href="#" class="btn btn-primary">Filter</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="stat-panel-container">
                <div class="stat-panel">
                    <span class="stat-title">MEMBERS</span>
                    <span class="stat-figure">@Model.counts.members</span>
                </div>
                <div class="stat-panel">
                    <span class="stat-title">GUESTS</span>
                    <span class="stat-figure">@Model.counts.guests</span>
                </div>
                <div style="clear: both;"></div>
            </div>
            @Html.Partial("PagerTop", Model.Pager)
            <div class="table-responsive">
                <table id="Checkins" class="table table-striped">
                    <thead>
                        <tr>
                            <th><a href="#" class="sortable">Host</a> / <a href="#" class="sortable">Person</a></th>
                            <th><a href="#" class="sortable">Date / Time</a></th>
                            <th><a href="#" class="sortable">Activity</a></th>
                            <th>Access Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var t in Model.FetchTimes())
                        {
                            <tr>
                                <td>@t.name</td>
                                <td>@t.ctime.CheckInTimeX.FormatDateTm()</td>
                                <td>@t.activities</td>
                                <td>@at[t.accesstype]</td>
                            </tr>
                            if (t.guestcount > 0)
                            {
                                foreach (var g in t.guests)
                                {
                                    <tr style="font-style: italic;">
                                        <td><a href="#" person id="@g.PeopleId"> --- @g.Person.Name</a></td>
                                        <td>@g.CheckInTimeX.FormatDateTm()</td>
                                        <td>@string.Join(",", g.CheckInActivities.Select(e => e.Activity))</td>
                                        <td>@at[g.AccessTypeID ?? 0]</td>
                                    </tr>
                                }
                            }
                        }
                    </tbody>
                </table>
            </div>
            @Html.Partial("PagerBottom", Model.Pager)
            @Html.Hidden("totcnt", Model.Count().ToString("N0"))
            @Html.Hidden("Page", Model.Pager.Page)
            @Html.Hidden("Sort", Model.Pager.Sort)
            @Html.Hidden("Direction", Model.Pager.Direction)
            @Html.Hidden("membercount", Model.counts.members)
            @Html.Hidden("guestcount", Model.counts.guests)
            <br/>
        </div>
        <div class="col-md-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Check-in Totals</h3>
                </div>
                <table class="table table-striped">
                    <tbody>
                        @foreach (var t in Model.FetchActivityCount())
                        {
                            <tr>
                                <td> @t.name</td>
                                <td>@t.count</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</form>
@section scripts
{
    <script type="text/javascript">
        $(function () {
            
            $.gotoPage = function (e, pg) {
                $("#Page").val(pg);
                $.getTable();
                return false;
            };

            $.setPageSize = function (e) {
                $('#Page').val(1);
                $("#PageSize").val($(e).val());
                $.getTable();
                return false;
            };

            $.getTable = function () {
                var f = $("#form").submit();
                return false;
            };
            $('#filter').click(function (ev) {
                ev.preventDefault();
                $.getTable();
            });
            $("#clear").click(function (ev) {
                ev.preventDefault();
                $("input:text").val("");
                $('input:checkbox').removeAttr('checked');
                $('#peopleid').val(0);
                $("#activity").val(0);
                $("#accesstype").val(0);
                $.getTable();
            });
        });
    </script>
}