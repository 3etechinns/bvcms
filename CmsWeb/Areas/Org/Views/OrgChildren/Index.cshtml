@model CmsWeb.Areas.Org.Models.OrgChildrenModel
@using CmsData
@using CmsWeb
@using UtilityExtensions
@{
    Layout = ViewExtensions2.TouchPointLayout();
    ViewBag.Title = "Manage Child Organizations";
    ViewBag.PageHeader = "Manage Child Organizations";
    ViewBag.PageSubHeader = "<a href=\"{0}/{1}\">{2}</a>{3}".Fmt(Util2.Org, Model.org.OrganizationId, Model.org.OrganizationName, Model.parentorg != null ? " (Parent Org: <a href=\"/OrgChildren/{0}\">{1}</a>)".Fmt(Model.parentorg.OrganizationId, Model.parentorg.OrganizationName) : "");
}
<div class="row">
    <div class="col-md-9">
        <div class="box box-responsive">
            <div class="box-content">
                @if (Model.canedit)
                {
                    @Html.Hidden("canedit", "true")
                }
                <form id="groupsform" action="/OrgChildren/Update" method="post">
                    @Html.Partial("Form", Model)
                </form>
            </div>
        </div>
    </div>
</div>
@section scripts
{
    <script type="text/javascript">
        $(function () {

            function initializePopovers() {
                $('[data-toggle="popover"]').popover({ html: true });
                $('[data-toggle="popover"]').click(function (ev) {
                    ev.preventDefault();
                });
            }

            initializePopovers();

            $.loadTable = function () {
                $.getTable($('#groupsform'));
            };

            $('body').on('click', '#filter', function (ev) {
                ev.preventDefault();
                $.loadTable();
            });

            $("#groupsform").delegate("#memtype", "change", $.loadTable);

            $("#namesearch").keypress(function (ev) {
                if (ev.keyCode == '13') {
                    ev.preventDefault();
                    $.loadTable();
                }
            });

            $.getTable = function (f) {
                var q = f.serialize();
                $.post("/OrgChildren/Filter", q, function (ret) {
                    $('#table-results > tbody').html(ret).ready($.fmtTable);
                    initializePopovers();
                });
                return false;
            };

            $('body').on('click', 'a.display', function (ev) {
                ev.preventDefault();
                var f = $(this).closest('form');
                var q = f.serialize();
                $.post(this.href, q, function (ret) {
                    $(f).html(ret).ready(function () {
                        $.fmtTable();
                        return false;
                    });
                });
                return false;
            });

            $('body').on('change', '.orgcheck', function (ev) {
                var ck = $(this);
                var tr = ck.parent().parent();
                $.post("/OrgChildren/UpdateOrg/", {
                    ParentOrg: $("#orgid").val(),
                    ChildOrg: ck.attr("oid"),
                    Checked: ck.is(':checked')
                }, function (ret) {
                    tr.effect("highlight", {}, 3000);
                });
            });
        });
    </script>
}