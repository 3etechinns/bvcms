@using System.ServiceModel.Channels
@using CmsData.Codes
@using CmsWeb
@using UtilityExtensions
@model CmsWeb.Areas.Org.Models.VisitorModel
@Html.Hidden("visitor-qid", (Guid?)ViewBag.queryid)
<p style="margin-bottom:5px">
  Count: <strong id="visitor-count">@Model.Count()</strong>
  <a class="filtergroupslink bt" href="#" title="Filter by name/group">Filter@(Model.isFiltered ? "(filtered)" : "")</a>
  @Html.CheckBox("showHidden") Show Hidden Guests
</p>
<table id="MemberGrid" class="@ViewExtensions2.GridClass" cellpadding="4">
  <thead>
    <tr>
      <th><br /><a href="#" class="sortable">Name</a></th>
      <th></th>
      <th class="left">
        <a title="Sort by Church Member Status" href="#" class="sortable">Church</a><br />
        <a href="#" class="sortable">Age</a> - <a title="Sort by Birthday" href="#" class="sortable">Bday</a>
      </th>
      <th><br /><a href="#" class="sortable">Primary Address</a></th>
      <th><br />Communication</th>
      <th><br /><a href="#" class="sortable">Last Attended</a></th>
      <th><br />Tag</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var om in Model.Visitors())
    {
      <tr>
        <td><img src="/Content/images/individual.gif" border="0" /> <a href="/Person2/@om.PeopleId">@om.Name</a></td>
        <td>
          <a href="/Organization/Join/@Model.OrganizationId/@om.PeopleId" class="joinlink"
             confirm="Make @om.Name a Member of this Org?">Join Org</a>
          @if (om.MemberTypeId != MemberTypeCode.Prospect)
          {
            <br /><a href="/Organization/AddProspect/@Model.OrganizationId/@om.PeopleId" class="joinlink"
                     confirm="Make @om.Name a Prospect of this Org?">Add as Prospect</a>
          }
        </td>
        <td>
          @om.MemberStatus<br />
          @om.Age - @om.BirthDate
        </td>
        <td>
          <a href="http://www.google.com/maps?q=@om.Address,@om.CityStateZip" target="_blank">
            @om.Address
          </a><br />
          @om.CityStateZip
        </td>
        <td>
          @foreach (var ph in om.Phones)
          {
            @ph<br />
          }
          <a href="mailto:@om.Name <@om.EmailAddress>">@om.EmailAddress</a>
        </td>
        <td>
          <a href="/Meeting/@om.LastMeetingId">@om.LastAttended.FormatDate()</a><br />
          @if (om.GuestHidden)
          {
            <a href="/Organization/ShowVisitor/@Model.OrganizationId/@om.PeopleId/@om.LastAttendId/Show" class="joinlink"
               confirm="Show @om.Name as a Guest for this Org?">Show</a>
          }
          else
          {
            <a href="/Organization/ShowVisitor/@Model.OrganizationId/@om.PeopleId/@om.LastAttendId/Hide" class="joinlink"
               confirm="Hide @om.Name as a Guest for this Org until next visit?">Show</a>
          }
          </td>
          <td>
            <a pid='@om.PeopleId' title="Add to/Remove from Active Tag" class="taguntag" href="#">@(om.HasTag ? "Remove" : "Add")</a>
          </td>
        </tr>
    }
  </tbody>
</table>
@Html.Partial("Pager2", Model.Pager)
