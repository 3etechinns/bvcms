@using UtilityExtensions
@using CmsWeb
@using CmsData
@model Transaction
@{
    Layout = "/Views/Shared/onlinereg.cshtml";
    ViewBag.Title = "Online Registration";
}
@{
    var ti = Model;
    var ServiceUOrgID = (ti.Testing ?? false) ? DbUtil.Db.Setting("ServiceUOrgIDTest", "0") : DbUtil.Db.Setting("ServiceUOrgID", "0");
    var ServiceUOrgAccountID = (ti.Testing ?? false) ? DbUtil.Db.Setting("ServiceUOrgAccountIDTest", "0") : DbUtil.Db.Setting("ServiceUOrgAccountID", "0");
}

@section scripts
{
@Html.Script("/Scripts/OnlineRegPayment.js")
    <script type="text/javascript">
        $(function () {
            $(document).bind("idle.idleTimer", function () {
                window.location.href = '@ti.Url';
            });
            var tmout = parseInt('@ViewData["timeout"]');
            $.idleTimer(tmout);
        });
    </script>
}
    <h2>
        Payment Processing</h2>
@if (ViewData.ContainsKey("Terms"))
{ 
    <a id="displayterms" title="click to display terms" href="#">Display Terms</a>
    <div id="Terms" title="Terms of Agreement" class="modalPopup" style="display: none;
        width: 400px; padding: 10px">
        @ViewData["Terms"]</div>
    <p>
        @Html.CheckBox("IAgree")
        I agree to the above terms and conditions.</p>
    <p>
        You must agree to the terms above for you or your minor child before you can continue.</p>
} 
    <form action="/OnlineReg/ApplyCoupon" method="post">
    <p>If you have received a Coupon Code, please enter that number here and click
       the blue link next to it:</p>
    <input id="Coupon" name="Coupon" type="password" value="@ViewData["Coupon"]" autocomplete="off" /><br />
    <input type="button" href="/OnlineReg/PayWithCoupon/@ti.DatumId" class="submitbutton ajax"
        value="Apply Coupon" />
    <div>@Html.ValidationMessage("coupon")</div>
    </form>
    <p> 
        When you click the 'Make Payment' button you will be redirected to ServiceU.com
        to process your payment of
        $@ti.Amt.Value.ToString("N"). After you are finished there, you will be redirected
        back here to get your confirmation. Your information will not be committed until
        you complete the transaction on the next page.
    </p>
    <form action="https://public.serviceu.com/transaction/pay.asp" method="post">
    @Html.Hidden("OrgID", ServiceUOrgID)
    @Html.Hidden("OrgAccountID", ServiceUOrgAccountID)
    @Html.Hidden("Amount", ti.Amt)
    @Html.Hidden("PostbackURL", Util.ServerLink("/OnlineReg/Confirm/" + ti.DatumId))
    @Html.Hidden("NameOnAccount", ti.Name)
    @Html.Hidden("Address", ti.Address)
    @Html.Hidden("City", ti.City)
    @Html.Hidden("State", ti.State)
    @Html.Hidden("PostalCode", ti.Zip)
    @Html.Hidden("Phone", ti.Phone)
    @Html.Hidden("Email", Util.FirstAddress(ti.Emails))
    @Html.Hidden("Misc1", ti.Name)
    @Html.Hidden("Misc2", ti.Description)
    @Html.Hidden("Misc3")
    @Html.Hidden("Misc4")
    <p>
        <input id="Submit" type="submit" name="Submit" value="Make Payment" /></p>
    </form>


