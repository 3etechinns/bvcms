@using UtilityExtensions
@model CmsWeb.Models.OnlineRegModel
@{
    Layout = Model.UseBootstrap
        ? "~/Views/Shared/onlinereg2.cshtml"
        : "~/Views/Shared/onlinereg.cshtml";
    ViewBag.Title = "Online Registration";
}
@section head
{
    @if (Model.DisplaySpecialFunds)
    {
        <link rel="stylesheet" href="@Url.Content("/Content/select2-3.5.2/select2.css")" />
        <link rel="stylesheet" href="@Url.Content("/Content/select2-3.5.2/select2-bootstrap.css")" />
    }
}
@section scripts
{
    <script type="text/javascript">
        $.dateFormat = '@Util.jQueryDateFormat';
        $.timeoutUrl = '/OnlineReg/Timeout?ret=' + encodeURI('@Model.URL');
        $.tmout = parseInt('@Model.TimeOut');
    </script>
    @(Model.UseBootstrap 
        ? @Fingerprint.Script("/Scripts/OnlineReg/OnlineReg2.js")
          : @Fingerprint.Script("/Scripts/OnlineReg/OnlineReg.js"))
    
    @if (Model.DisplaySpecialFunds)
    {
        <script type="text/javascript" src="@Url.Content("/Scripts/select2-3.5.2/select2.min.js")"></script>
        <script>
            function addFundRow(id, text) {
                var rowId = '#special-funds tbody tr#' + id;
                if ($(rowId).length) {
                    // do nothing
                } else {
                    var i = $('#funds tbody tr').length + $('#special-funds tbody tr').length;
                    var inputName = 'List[0].FundItem[' + i + '].Value';
                    $('#special-funds > tbody:last').append('<tr id="' + id + '"><td style="width: 10px;"><a href="#" class="remove-fund"><span class="fa fa-trash-o"></span></a></td><td>' + text + '</td><td><div class="pull-right"><input type="hidden" name="List[0].FundItem[' + i + '].Key" value="' + id + '"><input name="' + inputName + '" type="text" class="form-control narrow sum"/></div></td></tr>');
                    $('input[name="' + inputName + '"]').focus();
                }
            }

            $(document).ready(function() {
                $('#special-funds-list').select2({
                    placeholder:'Select a Special Fund'
                });
                $('input:text').first().focus();

                $('#special-funds-list').on('change', function (e) {
                    addFundRow(e.added.id, e.added.text);
                    $('#special-funds-list').select2('val', '');
                });

                $(document).on("click", "a.remove-fund", function (e) {
                    e.preventDefault();
                    $(this).closest('tr').remove();
                });


            });
        </script>
    }
}
<noscript>
    <style type="text/css">
        .pagecontainer {
            display: none;
        }
    </style>
    <div class="noscriptmsg">
        This registration site requires javascript to be enabled on your browser.
    </div>
</noscript>

@if (Model.UseBootstrap)
{
<div class="regform">
    <h3>@Model.Header</h3>
    @{var msg = Model.Filled();}
    @if (Model.NotAvailable())
    {
        <h4 id="sorry">Sorry, Registration is not available at this time</h4>
        @Html.Raw(Util.PickFirst(Model.Instructions, ""))
    }
    else if (msg.HasValue())
    {
        <h4 id="sorry">Sorry, @msg</h4>
        @Html.Raw(Util.PickFirst(Model.Instructions, ""))
    }
    else
    {
        <form id="completeReg" class="DisplayEdit form-horizontal" action="/OnlineReg/@(Model.AskDonation() ? "AskDonation" : "CompleteRegistration")/@Model.qtesting" method="post">
            @Html.Partial("Flow2/List", Model)
        </form>
        if (Model.RecordFamilyAttendance())
        {
            @Html.Partial("Flow2/FamilyAttendTemplate")     
        }
    }
</div>
}
else
{
<div class="regform pagecontainer">
    <h2>@Model.Header</h2>
    @{var msg = Model.Filled();}
    @if (Model.NotAvailable())
    {
        <h4 id="sorry">Sorry, Registration is not available at this time</h4>
        @Html.Raw(Util.PickFirst(Model.Instructions, ""))
    }
    else if (msg.HasValue())
    {
        <h4 id="sorry">Sorry, @msg</h4>
        @Html.Raw(Util.PickFirst(Model.Instructions, ""))
    }
    else
    {
        <form id="completeReg" class="DisplayEdit" action="/OnlineReg/@(Model.AskDonation() ? "AskDonation" : "CompleteRegistration")/@Model.qtesting" method="post">
            @Html.Partial("Flow/List", Model)
        </form>
    }
</div>
}