@using UtilityExtensions
@model CmsWeb.Models.OnlineRegModel
@{
    Layout = "/Views/Shared/onlinereg.cshtml";
    ViewBag.Title = "Online Registration";
}
<noscript>
    <style type="text/css">
        .pagecontainer {display:none;}
    </style>
    <div class="noscriptmsg">
    This registration site requires javascript to be enabled on your browser.
    </div>
</noscript>
<div class="regform pagecontainer">
@Html.Raw(SquishIt.Framework.Bundle.JavaScript()
        .Add("/Content/js/jquery-1.5.2.js")
        .Add("/Content/js/jquery-ui-1.8.13.custom.js")
        .Add("/Content/js/jquery.validate.js")
        .Add("/Content/js/jquery.idle-timer.js")
        .Add("/Scripts/OnlineReg.js")
        .Render("/Content/OnLineReg_#.js")
)
    <script type="text/javascript">
        $(function () {
            $(document).bind("idle.idleTimer", function () {
                window.location.href = '@Model.URL';
            });
            var tmout = parseInt('@ViewData["timeout"]');

            if ($('input:text[value!=""]').length == 0)
                $(document).bind("keydown", function () {
                    $(document).unbind("keydown");
                    $.idleTimer(tmout);
                });
            else
                $.idleTimer(tmout);
        });
    </script>
    <h2>@Model.Header</h2>
@{var msg = Model.Filled();}
@if (Model.NotAvailable())
{ 
    <h4>Sorry, Registration is not available at this time</h4>
}
else if (msg.HasValue())
{ 
    <h4 id="sorry">Sorry, @msg</h4>
        @Html.Raw(Util.PickFirst(Model.Instructions, ""))
}
else
{ 
    @Html.Raw(Util.PickFirst(Model.Instructions, @"
<div class=""instructions login"">
</div>
<div class=""instructions find"">
</div>
<div class=""instructions select"">
</div>
<div class=""instructions other"">
</div>
<div class=""instructions submit"">
</div>
<div class=""instructions sorry"">
</div>
"))
<form class="DisplayEdit" action="/OnlineReg/@(Model.AskDonation()? "AskDonation" : "CompleteRegistration")/@Model.qtesting" method="post">
@Html.Partial("Flow/List", Model) 
</form>
}
</div>