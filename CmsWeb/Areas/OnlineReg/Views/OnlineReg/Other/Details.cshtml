@using CmsData
@using CmsData.Registration
@using UtilityExtensions
@model CmsWeb.Areas.OnlineReg.Models.OnlineRegPersonModel
@{
    var om = Model.GetOrgMember();
    var ti = Model.Parent.Transaction;
  var sty = new Sty();
}
@* ReSharper disable Html.Obsolete *@
<table>
  <tr>
    <td colspan="2" style="@sty.dd@sty.bb">
      <p>
        <hr/>
        Registrant: @Model.person.Name<br/>
        for @Model.org.OrganizationName
      </p>
    </td>
  </tr>
@if ((ti.Amt ?? 0) > 0 && om != null)
{
  var ts = om.TransactionSummary(DbUtil.Db);
  <tr>
    <td colspan="2" style="@sty.bb">
      <table>
        <tr>
          <td style="@sty.lb">Registrant Fee</td>
          <td style="@sty.lb">Amount Paid</td>
          <td style="@sty.lb">Amount Due</td>
        </tr>
        <tr>
          <td align='right' style="@sty.dd">@ts.IndAmt.ToString2("c")</td>
          <td align='right' style="@sty.dd">@om.TotalPaid(DbUtil.Db).ToString("c")</td>
          <td align='right' style="@sty.dd">@om.AmountDue(DbUtil.Db).ToString("c")</td>
        </tr>
      </table>
    </td>
  </tr>
}
@if (Model.Parent.SupportMissionTrip)
{
  var goer = DbUtil.Db.LoadPersonById(Model.MissionTripGoerId ?? 0);
  <tr>
    <td colspan="2">
      <table>
        @if (goer != null)
        {
          <tr>
            <td style="@sty.lb">Support Mission Trip for</td>
            <td style="@sty.dd">@goer.Name</td>
          </tr>
        }
        @if (Model.MissionTripSupportGeneral > 0)
        {
          <tr>
            <td style="@sty.lb">Support Mission Trip</td>
            <td style="@sty.dd">Any other participiants</td>
          </tr>
        }
      </table>
    </td>
  </tr>
}
else
{
  var rr = Model.person.GetRecReg();
  foreach (var ask in Model.setting.AskItems)
  {
    switch (ask.Type)
    {
      case "AskTickets":
        <tr>
          <td style="@sty.lb@sty.bb">Tickets</td>
          <td style="@sty.dd@sty.bb">@om.Tickets</td>
        </tr>
        break;
      case "AskSize":
        <tr>
          <td style="@sty.lb@sty.bb">Shirt</td>
          <td style="@sty.dd@sty.bb">@om.ShirtSize</td>
        </tr>
        break;
      case "AskEmContact":
        <tr><td></td><td style="@sty.dl">Emergency</td></tr>
        <tr>
          <td style="@sty.lb">Contact</td>
          <td style="@sty.dd">@rr.Emcontact</td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb">Phone</td>
          <td style="@sty.dd@sty.bb">@rr.Emphone</td>
        </tr>
        break;
      case "AskDoctor":
        <tr>
          <td style="@sty.lb">Doctor</td>
          <td style="@sty.dd">@rr.Doctor</td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb">Phone</td>
          <td style="@sty.dd@sty.bb">@rr.Docphone</td>
        </tr>
        break;
      case "AskInsurance":
        <tr>
          <td style="@sty.lb">Insurance Carrier:</td>
          <td style="@sty.dd">@rr.Insurance</td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb">Insurance Policy:</td>
          <td style="@sty.dd@sty.bb">@rr.Policy</td>
        </tr>
        break;
      case "AskRequest":
        <tr>
          <td style="@sty.lb">Request</td>
          <td style="@sty.dl">@(((AskRequest) ask).Label)</td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb"></td>
          <td style="@sty.dd@sty.bb">@om.Request</td>
        </tr>
        break;
      case "AskHeader":
        <tr>
          <td></td>
          <td style="@sty.dl@sty.bb">@Html.Raw(((AskHeader) ask).Label)</td>
        </tr>
        break;
      case "AskInstruction":
        <tr>
          <td></td>
          <td style="@sty.dl@sty.bb">@Html.Raw(((AskInstruction) ask).Label)</td>
        </tr>
        break;
      case "AskAllergies":
        <tr>
          <td style="@sty.lb@sty.bb">Medical</td>
          <td style="@sty.dd@sty.bb">@rr.MedicalDescription</td>
        </tr>
        break;
      case "AskTylenolEtc":
        <tr>
          <td style="@sty.lb">Tylenol</td>
          <td style="@sty.dd">
            @YesNo(Model.tylenol)
          </td>
        </tr>
        <tr>
          <td style="@sty.lb">Advil</td>
          <td style="@sty.dd">
            @YesNo(Model.advil)
          </td>
        </tr>
        <tr>
          <td style="@sty.lb">Robitussin</td>
          <td style="@sty.dd">
            @YesNo(Model.robitussin)
          </td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb">Maalox</td>
          <td style="@sty.dd@sty.bb">
            @YesNo(Model.maalox)
          </td>
        </tr>
        break;
      case "AskChurch":
        <tr>
          <td style="@sty.lb">Church</td>
          <td style="@sty.dd">@(rr.Member == true ? "" : "Not") Member</td>
        </tr>
        <tr>
          <td style="@sty.bb"></td>
          <td style="@sty.dd@sty.bb">
            @(rr.ActiveInAnotherChurch == true ? "" : "Not") Active in another church
          </td>
        </tr>
        break;
      case "AskParents":
        <tr>
          <td style="@sty.lb">Mother</td>
          <td style="@sty.dd">@rr.Mname</td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb">Father</td>
          <td style="@sty.dd@sty.bb">@rr.Fname</td>
        </tr>
        break;
      case "AskCoaching":
        <tr>
          <td style="@sty.lb@sty.bb">Coaching</td>
          <td style="@sty.dd@sty.bb">@rr.Coaching</td>
        </tr>
        break;
      case "AskSMS":
        <tr>
          <td style="@sty.lb@sty.bb">Receive Texts</td>
          <td style="@sty.dd@sty.bb">@Model.person.ReceiveSMS</td>
        </tr>
        break;
      case "AskDropdown":
        <tr>
          <td></td>
          <td style="@sty.dl">@Util.PickFirst(((AskDropdown) ask).Label, "Options")</td>
        </tr>
        <tr>
          <td style="@sty.lb@sty.bb">Selected</td>
          <td style="@sty.dd@sty.bb">
            @(((AskDropdown) ask).SmallGroupChoice(Model.option).Description)
          </td>
        </tr>
        break;
      case "AskMenu":
        var menulabel = "Choices";
        var mlist = ((AskMenu) ask).MenuItemsChosen(Model.MenuItem[ask.UniqueId]).ToList();
        if (mlist == null || !mlist.Any()) { continue; }
        var lasti = mlist.Last();
        <tr><td style="@sty.lb">Menu</td><td style="@sty.dl">@(((AskMenu)ask).Label)</td></tr>
        foreach (var i in mlist)
        {
          var ibb = lasti.desc == i.desc ? $";{sty.bb}" : "";
          if (i.amt > 0)
          {
            <tr>
              <td style="@sty.lb@ibb">@menulabel</td>
              <td style="@sty.dd@ibb">@i.number @i.desc (at @i.amt.ToString("N2"))</td>
            </tr>
          }
          else
          {
            <tr>
              <td style="@sty.lb@ibb">@menulabel</td>
              <td style="@sty.dd@ibb">@i.number @i.desc</td>
            </tr>
          }
          menulabel = string.Empty;
        }
        break;
      case "AskCheckboxes":
        var askcb = (AskCheckboxes) ask;
        menulabel = askcb.Label;
        var cbq = askcb.CheckboxItemsChosen(Model.Checkbox).ToList();
        var lastcb = cbq.Last().SmallGroup;
        if (menulabel.HasValue())
        {
          <tr>
            <td></td>
            <td style="@sty.dl">@menulabel</td>
          </tr>
        }
        <tr>
          <td style="@sty.lb@sty.bb@sty.tp">Selected</td>
          <td style="@sty.bb">
            @foreach (var i in cbq)
            {
              var ibb = lastcb == i.SmallGroup ? "" : $"{sty.bb}";
              if (i.Fee > 0)
              {
                <div style="@sty.dd@ibb">
                  @i.Description ($@i.Fee.ToString2("N2"))<br/>(@i.SmallGroup)
                </div>
              }
              else
              {
                <div style="@sty.dd@ibb">
                  @i.Description<br/>(@i.SmallGroup)
                </div>
              }
            }
          </td>
        </tr>
        break;
      case "AskYesNoQuestions":
        var ynq = ((AskYesNoQuestions) ask).list.Where(a => Model.YesNoQuestion.ContainsKey(a.SmallGroup)).ToList();
        var lastyn = ynq.Last();
        foreach (var a in ynq)
        {
          var ibb = lastyn == a ? $";{sty.bb}" : $";{sty.pb}";
          <tr>
            <td style="@sty.lb">Question</td>
            <td style="@sty.dl">@a.Question</td>
          </tr>
          <tr>
            <td style="@sty.lb@ibb">Answer</td>
            <td style="@sty.dd@ibb">@(Model.YesNoQuestion[a.SmallGroup] == true ? "Yes" : "No")</td>
          </tr>
        }
        break;
      case "AskExtraQuestions":
        var eqq = Model.ExtraQuestion[ask.UniqueId].Where(a => a.Value.HasValue()).ToList();
        var lasteq = eqq.Last();
        foreach (var a in eqq)
        {
          var ibb = lasteq.Key == a.Key ? $";{sty.bb}" : $";{sty.pb}";
          <tr>
            <td style="@sty.lb">Question</td>
            <td style="@sty.dl">@a.Key</td>
          </tr>
          <tr>
            <td style="@sty.lb@ibb">Answer</td>
            <td style="@sty.dd@ibb">@a.Value</td>
          </tr>
        }
        break;
      case "AskText":
        var tqq = Model.Text[ask.UniqueId].Where(a => a.Value.HasValue()).ToList();
        var lasttq = tqq.Last();
        foreach (var a in tqq)
        {
          var ibb = lasttq.Key == a.Key ? $";{sty.bb}" : $";{sty.pb}";
          <tr>
            <td style="@sty.lb">Question</td>
            <td style="@sty.dl">@a.Key</td>
          </tr>
          <tr>
            <td style="@sty.lb@ibb">Answer</td>
            <td style="@sty.dd@ibb">@a.Value</td>
          </tr>
        }
        break;
      case "AskGradeOptions":
        <tr>
          <td style="@sty.lb@sty.bb">Grade</td>
          <td style="@sty.dd@sty.bb">@Model.GradeOptions(ask).SingleOrDefault(s => s.Value == (Model.gradeoption ?? "00")).Text</td>
        </tr>
        break;
    }
  }
  if (Model.setting.AgeGroups.Count > 0)
  {
    <tr>
      <td style="@sty.lb">AgeGroup:</td>
      <td style="@sty.dd">@Model.AgeGroup()</td>
    </tr>
  }
}
</table>
@helper YesNo(bool? tf)
{
    @(tf == true ? "Yes" : tf == false ? "No" : "")
}
