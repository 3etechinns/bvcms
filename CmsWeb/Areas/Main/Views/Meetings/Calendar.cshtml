@using System.Web.Optimization
@using UtilityExtensions
@using CmsWeb
@model CmsWeb.Models.MeetingsModel
@{
    Layout = "/Views/Shared/SiteLayout.cshtml";
    ViewBag.Title = "Volunteer Calendar";
    const string dayHourFmt = "ddd h:mm tt"; 
}
@section head
{
<style type="text/css">
#container { margin: 3em auto  0 3em; padding-bottom: 3em; background-color: #fff; }
#month { border-collapse: collapse; margin-left: 2em; }
#month th, #month td { border: 1px solid #000; }
#month thead { background-color:#9c9; }
#month td { min-width: 7em; padding: .2em; vertical-align: top; overflow: auto; }
#month td .day { min-width: 7em; min-height: 1em;  }
#month thead th { font: 150% bold Arial, Helvetica, sans-serif; padding: .2em; }
.wk-1 { background-color: #C5ECC5; }
.wk-2 { background-color: #E2E2FF; } 
.wk-3 { background-color: #FFE5E5; }
.wk-4 { background-color: #FFFFE2; }
.wk-5 { background-color: #EAEAEA; }
div.drop { border:1px dashed gray; background-color:lightgray;color:gray;cursor:pointer;padding:3px; }
.selected { background: #F39814 !important; color: white !important; }
.pidHighlight { background: #F3CB92 !important; }
.pidHighlight2 { background: #F3BEA9;}
div.selectable { cursor:cell;padding:3px; border: 1px solid transparent }
div.selectable:hover { border: 1px dotted gray;}
div.selectable h3 { color: blue; }
 /* Coming */
.commit-1 { color: black;  }
 /* Regrets */
.commit-0 { text-decoration: line-through; color: gray; font-size: 90%; }
 /* Finding Sub */
.commit-2 { font-weight:bold; color:blue; font-size:90%; font-style: italic; border: 1px dashed red !important;  }
 /* Sub Found */
.commit-3 { text-decoration: line-through; color: blue;font-size: 90%; }
 /* Substitute */
.commit-4 { color: #008000; }
</style>
}
@section scripts
{
}
@Html.Hidden("OrgId", Model.OrgId)
<h2>Future Calendar for @Html.ActionLink(Model.OrgName, "Index", "Organization", new { area = "Main", id = Model.OrgId }, null)</h2>
<table>
    <tr>
		<td valign="top">
			<table id="month">
				<thead>
					<tr>
						<th>Week</th>
						@foreach (var t in Model.times)
						{ 
							<th>@t.ToString(dayHourFmt)</th>
						}
					</tr>
				</thead>
				<tbody>
						<tr>
							<td valign="middle" align="center">All Weeks</td>
							@foreach (var t in Model.times)
							{
								<td><div class="drop day" target="week" week="0" time="@t">target</div></td>
							}
						</tr>
					@for (var wk = 1; wk <= 5; wk++)
					{
						<tr>
							<td valign="middle" align="center">Week @wk</td>
							@foreach (var t in Model.times)
							{
								<td><div class="drop day" target="week" week="@wk" time="@t">target</div></td>
							}
						</tr>
					}
					<thead>
						<tr>
							<th> <a id="SortIt" href="#">@(Model.SortByWeek ? "Sort by Date" : "Sort by Week #")</a> </th>
							@foreach (var t in Model.times)
							{ 
								<th>@t.ToString(dayHourFmt)</th>
							}
						</tr>
					</thead>
					@foreach (var w in Model.FetchSlotWeeks())
					{ 
						<tr class="wk-@w[0].Week">
							<td valign="top" align="center">
								<p><span class="date">@w[0].Sunday.ToShortDateString()<br />
									   Week @w[0].Week</span>
								</p><div class="day"></div></td>
							@foreach (var t in w)
							{
								<td>
									<p class="date">
										@if (t.MeetingId > 0)
										{
											@Html.ActionLink("Rollsheet ({0}/{1})".Fmt(t.Count, t.Limit), "Rollsheet", "Reports", new { area = "Main", meetingid = t.MeetingId }, new { target = "_blank" })<br/>
											@Html.ActionLink("Email", "EmailSlot", "Volunteers", new { id = t.MeetingId }, new { target = "meeting" })<br/>
											@Html.ActionLink("Meeting", "Index", "Meeting", new { area = "Main", id = t.MeetingId }, new { target = "meeting" })<br/>
											@Html.ActionLink("Request Volunteers", "Request", "Volunteers", new { mid = t.MeetingId, limit = t.Limit }, new { tClass = "volreq", target="_blank" })
										}
										else
										{
											@Html.ActionLink("Request Volunteers", "Request0", "Volunteers", new { ticks = t.ticks, oid = Model.OrgId, limit = t.Limit }, new { @class = "volreq", target="_blank" })
										}
									</p>
									@foreach (var p in t.OrderedPersons())
									{
										if (Model.IsLeader)
										{
											<div pid="@p.PeopleId" mid="@t.MeetingId" class="selectable commit-@p.Commitment" source="registered" title="@p.CommitmentText">@p.Name</div>
										}
										else
										{
											<div>@Html.ActionLink(p.Name, "Index", "Person", new { area = "Main", id = p.PeopleId }, null)</div>
										}
									}
									<div class="drop day" target="meeting" time="@t.Time">target</div>
								</td>
							} 
						</tr>
					}
				</tbody>
			</table>
		</td>
        <td>&nbsp;</td>
		<td valign="top">
        @if (Model.IsLeader)
        {
            <p>
                @if (User.IsInRole("Edit"))
                {
                    @Html.ActionLink("Email Reminders", "Reminders", "Organization", new {area = "Main", id = Model.OrgId}, new {id = "sendreminders", @class = "bt"})
                }
                else
                {
                    <a enabled="false">Email Reminders</a>
                }
                @Html.CheckBox("emailall") Email All (default next 7 days)
            </p>
            <p>Small Group Filters<br />
                @Html.DropDownList("sg1", Model.SmallGroups(), new { @class="smallgroup" })<br />
                @Html.DropDownList("sg2", Model.SmallGroups(), new { @class="smallgroup" })
            </p>
            <div class="drop day" target="clear" week="0" time="1-1-1000" style="padding:5px;height:2em;border:2px solid black;">target here to remove commitments</div>
            <h4><em>Select header items in blue below, or a person, then click a target</em></h4>
            var vlist = Model.Volunteers().ToList();
            <div class="volunteers">
            <div class="selectable" source="all"><h3>All Volunteers</h3></div>
            <div class="selectable" source="commits"><h3>With Commitments</h3></div>
            @foreach (var v in vlist.Where(vv => vv.commits > 0))
            {
        	<div class="selectable" source="person" pid="@v.PeopleId">@v.Name (@v.commits) 
                @Html.ActionLink("registration page", "ManageVolunteer", "OnlineReg", new { area = "OnlineReg", id = v.OrgId, pid = v.PeopleId }, new { target = "committments" })</div> 
            }
            <div class="selectable" source="nocommits"><h3>With No Commitments</h3></div>
            @foreach (var v in vlist.Where(vv => vv.commits == 0))
            {
        	<div class="selectable" source="person" pid="@v.PeopleId">@v.Name (@v.commits) 
                @Html.ActionLink("registration page", "ManageVolunteer", "OnlineReg", new { area = "OnlineReg", id = v.OrgId, pid = v.PeopleId }, new { target = "committments" })</div> 
            }
            </div>
        }
		</td>
    </tr>
</table>