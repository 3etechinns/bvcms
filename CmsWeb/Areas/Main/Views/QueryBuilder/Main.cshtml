@using CmsWeb
@model CmsWeb.Models.QueryModel
@{
    Layout = "/Views/Shared/SiteLayout.cshtml";
    ViewBag.Title = "QueryBuilder";
}
@section head 
{
    <link href="/Content/jquery.multiSelect.css" rel="stylesheet" type="text/css" />
}

<div>
@Html.Raw(SquishIt.Framework.Bundle.JavaScript()
            .Add("/Content/js/jquery.pagination.js")
            .Add("/Content/js/jquery.multiSelect.js")
            .Add("/Content/js/jquery.contextMenu.js")
            .Add("/Scripts/QueryBuilder.js")
        .Render("/Content/QueryBuilder_#.js")
)
</div>
<form id="conditionForm" action="/QueryBuilder/Main" method="get">
<div id="Description"><b>@Model.Description</b></div>
<div class="roundbox floatleft">
<h2 title="Then update or add it to the Conditions below">Configure a query condition</h2>
<table id="selectconditions" cellspacing="5">
    <tr>
        <td>
            <table style="border: 1px dashed #999" cellspacing="5">
                <tr id="CategoryDiv2">
                    <td colspan="2">
                      <a id="SelectCondition" href=#" class="bt">Select Condition</a>
                      <span id='ConditionText'>Group</span>
                      @Html.Hidden("ConditionName")
                    </td>
                </tr>
                <tr id="DaysDiv" style="display:none">
                    <td align="right">Days:</td>
                    <td>
                        @Html.TextBoxClass("Days", "validate")
                    </td>
                </tr>
                <tr id="AgeDiv" style="display:none">
                    <td align="right">Age Less or Equal:</td>
                    <td>
                        @Html.TextBoxClass("Age", "validate")
                    </td>
                </tr>
                <tr id="QuartersDiv" style="display:none">
                    <td align="right"><span id="QuartersLabel">Quarters</span>:</td>
                    <td>
                        @Html.TextBoxClass("Quarters", "validate")
                    </td>
                </tr>
                <tr id="ViewDiv" style="display:none">
                    <td align="right">Volunteer Views:</td>
                    <td>
                        @Html.DropDownList("View", Model.Views())
                    </td>
                </tr>
                <tr id="TagsDiv" style="display:none">
                    <td align="right">Tags:</td>
                    <td>
                        <span id="tagvalues" class="validate" style="display:none"></span>
                    </td>
                </tr>
                <tr id="SavedQueryDiv" style="display:none">
                    <td align="right">Saved Query:</td>
                    <td>
                        @Html.DropDownList("SavedQueryDesc", Model.SavedQueries())
                    </td>
                </tr>
                <tr id="MinistryDiv" style="display:none">
                    <td align="right">Ministry:</td>
                    <td>
                        @Html.DropDownList("Ministry", Model.Ministries())
                    </td>
                </tr>
                <tr id="StartDiv" style="display:none">
                    <td align="right">Start Date:</td>
                    <td>
                        @Html.TextBoxClass("StartDate", "datepicker validate")
                    </td>
                </tr>
                <tr id="EndDiv" style="display:none">
                    <td align="right">End Date:</td>
                    <td>
                        @Html.TextBoxClass("EndDate", "datepicker validate")
                    </td>
                </tr>
                <tr id="ProgDiv" style="display:none">
                    <td align="right">Program:</td>
                    <td>
                        @Html.DropDownList("Program", Model.Programs())
                    </td>
                </tr>
                <tr id="DivDiv" style="display:none">
                    <td align="right">Division:</td>
                    <td>
                        <select id="Division" ></select>
                    </td>
                </tr>
                <tr id="OrgDiv" style="display:none">
                    <td align="right">Organization:</td>
                    <td>
                        <select id="Organization" ></select>
                    </td>
                </tr>
                <tr id="SchedDiv" style="display:none">
                    <td align="right">Schedule:</td>
                    <td>
                        @Html.DropDownList("Schedule", Model.Schedules())
                    </td>
                </tr>
            </table>
        </td>
        <td valign="top">
            <b style="color:#999">Comparison</b><hr />
            @Html.DropDownList("Comparison", Model.Comparisons())
        </td>
        <td valign="top" id="RightPanel" style="display:none">
            <b style="color:#999">To Value</b><hr />
                <span id="values" style="display:none"></span>
                @Html.TextBoxClass("TextValue", "validate")
                @Html.TextBoxClass("NumberValue", "validate")
                @Html.TextBoxClass("IntegerValue", "validate")
                @Html.TextBoxClass("DateValue", "datepicker validate")
        </td>
    </tr>
    <tr>
        <td align="right">
            <a id="Update" class="conditionButton bt disabled"
                title="Copies the above condition into the selected condition below">Update</a>
            <a id="Add" class="conditionButton bt disabled"
                title="Adds the above condition after the selected condition below">Add</a>
            <a id="AddToGroup" href="#" class="conditionButton bt" 
                title="Adds the above condition to the group">Add To Group</a>
            <a id="Remove" class="conditionButton bt disabled"
                title="Removes the selected condition below">Remove</a>
        </td>
    </tr>
</table>
@Html.Hidden("SelectedId")
<h2>Conditions</h2>
<table cellspacing="5">
    <tr>
        <td title="Select a condition to edit it">
            <ul id="ConditionGrid">
             @Html.Partial("Conditions", Model) 
            </ul>
        </td>
        <td align="center" valign="bottom">
            <div>
                <input id="Run" type="image" src="/images/Run.png" alt="Run Query" title="Run Query" />
            </div>
            <div>Run</div>
        </td>
    </tr>
</table>
</div>
<div class="floatclear"></div>
<ul id="InsCopyMenu" class="popupMenu">
    <li><a href="#ins">Insert Group Above</a></li>
    <li><a href="#copy">Copy As New</a></li>
</ul>
<div id="toolbar" style='@(Model.ShowResults? "" : "display:none")'>
 @Html.Partial("ExportToolBar")
</div>
<div id="Results" style="clear:both; margin-top: 6px">
    @if (Model.ShowResults)
    {
       @Html.Partial("Results", Model) 
    }
</div>
</form>

@section PopupsPlaceholder
{
<div id="QueryConditionSelect" class="modalPopup" title="Select a Condition" style="display:none">
    <div id="tabber" class="ui-tabs">
        <ul class="ui-tabs-nav">
    @foreach(var c in Model.FieldCategories())
    { 
        <li><a href='#@c.Name'><span>@c.Title</span></a></li>
    }
        </ul>
    @foreach (var c in Model.FieldCategories()) 
    { 
        <div id="@c.Name" style="margin:4px;height:450px;overflow:auto" class="ui-tabs-panel ui-tabs-hide">
        @foreach (var p in c.Fields)
        { 
            <div class="FieldLink"><a id='@p.Name' href="#">@p.Title</a></div>
            <div class="moreinfo">@p.Description</div>
        } 
        </div>
    }
    </div>
</div>
<div id="OpenQueryDiv" title="Open Query" class="modalDiv">
    <select id="ExistingQueries"></select>
    <div style="text-align:right; vertical-align:bottom">
        <input id="OpenQuery" type="button" value="Open" />
    </div>
</div>
<div id="SaveQueryDiv" class="modalDiv">
    <div style="text-align: left">
        Query Description:
        @Html.TextBox("SaveQueryDesc")
        &nbsp;
        <input id="IsPublic" type="checkbox"/> Is Public
        <span class="footer">
            <a id="SaveQuery" href="#">Save</a>
        </span>
        <br />
    </div>
</div>
}

