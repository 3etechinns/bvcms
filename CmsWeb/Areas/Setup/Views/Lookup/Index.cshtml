@model IEnumerable<CmsWeb.Areas.Setup.Controllers.LookupController.Row>
@{
    Layout = ViewExtensions2.TouchPointLayout();
    ViewBag.Title = "Lookups";
}
@section head{
    @Fingerprint.Css("/Content/touchpoint/lib/bootstrap-editable/css/bootstrap-editable.css")
}
<h2>@ViewData["description"]</h2>
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible">
        <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <strong>Validation Error!</strong>&nbsp;&nbsp;@TempData["ErrorMessage"]
    </div>
}
<div class="row">
    <div class="col-sm-9">
        <div class="alert alert-info alert-dismissible">
            <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            Click to edit the Code or Name. The items that cannot be deleted are expected to be there by the system. The description for those can be edited as long as the meaning is the same.
        </div>
        <div class="table-responsive">
            <table class="table table-striped table-responsive">
                <tr>
                    <th style="width: 100px;">Id</th>
                    <th style="width: 300px;">Code</th>
                    <th style="width: 300px;">Description</th>
                    <th style="width: 100px;">Action</th>
                </tr>
                @foreach (var item in Model)
                {
                    <tr>
                        <td style="width: 100px;">@item.Id</td>
                        <td style="width: 300px;">
                            @if (item.Hardwired.GetValueOrDefault())
                            {
                                @item.Code
                            }
                            else
                            {
                                <a href="#" id="c@(item.Id).@ViewData["type"]" class="clickEdit" data-pk="c@(item.Id).@ViewData["type"]">@item.Code</a>
                            }
                        </td>
                        <td style="width: 300px;">
                            <a href="#" id="t@(item.Id).@ViewData["type"]" class="clickEdit" data-pk="t@(item.Id).@ViewData["type"]">@item.Description</a>
                        </td>
                        <td style="width: 100px;">
                            @if (!item.Hardwired.GetValueOrDefault())
                            {
                                <a id='d@(item.Id)' href="#" class="delete btn btn-sm btn-danger"><i class="fa fa-trash"></i> Delete</a>
                            }
                        </td>
                    </tr>
                }
            </table>
        </div>
    </div>
    <div class="col-sm-3">
        <div class="panel panel-default">
            <div class="panel-body">
                @using (Html.BeginForm("Create", "Lookup"))
                {
                    @Html.Hidden("type", ViewData["type"])
                    <div class="form-group">
                        <label for="id">New Id</label>
                        <input type="number" id="id" name="id" class="form-control" />
                    </div>
                    <input type="submit" class="btn btn-primary btn-block" value="Create" />
                }
            </div>
        </div>
    </div>
</div>
@section scripts
{
    @Fingerprint.Script("/Content/touchpoint/lib/bootstrap-editable/js/bootstrap-editable.min.js")
    <script type="text/javascript">
        $(function () {
            $.fn.editableform.buttons = '<button type="submit" class="btn btn-primary btn-sm editable-submit">' +
                                            '<i class="fa fa-fw fa-check"></i>' +
                                        '</button>' +
                                        '<button type="button" class="btn btn-default btn-sm editable-cancel">' +
                                            '<i class="fa fa-fw fa-times"></i>' +
                                        '</button>';

            $(".clickEdit").editable({
                mode: 'inline',
                type: 'text',
                url: "/Lookup/Edit/",
                params: function (params) {  
                    var data = {};
                    data['id'] = params.pk;
                    data['value'] = params.value;
                    return data;
                }
            });

            $("a.delete").click(function (e) {
                e.preventDefault();
                var id = $(this).attr("id");
                var type = $('#type').val();
                swal({
                    title: "Are you sure?",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonClass: "btn-danger",
                    confirmButtonText: "Yes, delete it!",
                    closeOnConfirm: false
                },
                function () {
                    $.post("/Lookup/Delete/" + id, { type: type }, function (ret) {
                        if (ret && ret.error)
                            swal("Error!", ret.error, "error");
                        else {
                            swal({
                                title: "Deleted!",
                                type: "success"
                            },
                            function () {
                                window.location = "/Lookup/" + $('#type').val();
                            });
                        }
                    });
                });
            });
        });
    </script>
}
