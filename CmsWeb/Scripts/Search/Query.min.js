function RefreshList(n){$.block(),$.ajax({type:"POST",url:"/Query/Results/",data:n,timeout:12e5,success:function(n){$("#toolbar").show(),$("#results").html(n),$("#people tbody tr:even").addClass("alt"),$("a.taguntag").click(function(n){return $.post("/Query/ToggleTag/"+$(this).attr("value"),null,function(t){t.error?alert(t.error):$(n.target).text(t.HasTag?"Remove":"Add")}),!1}),$("#people thead a.sortable").click(function(){var n=$(this).text(),i=$("#Sort").val(),t;return $("#Sort").val(n),t=$("#Direction").val(),i==n&&t=="asc"?$("#Direction").val("desc"):$("#Direction").val("asc"),RefreshList(),!1}),$.unblock()},error:function(n,t,i){$.unblock(),alert(i)}})}function ShowErrors(j){$(".validate").each(function(){$(this).next(".error").remove()});var e=eval("("+j+")");return e.count==0?!1:($(".validate").each(function(){e[this.id]&&$(this).after("<span class='error'> "+e[this.id]+"<\/span>")}),!0)}$(function(){var n,i=$('<div class="modal-backdrop hide" />').appendTo("body"),t;$("#conditions").on("click","a.edit-popover",function(){return n=$(this).closest("li.condition"),t(),!1});t=function(t){var i=n.data("qid");$("#editcondition").attr("originalheight",n.height()),$("#editcondition").is(":visible")&&$.HideEditCondition(),$.post("/Query/EditCondition/"+i,null,function(n){$("#editcondition .popover-content").html(n).ready(function(){$.AdjustEditCondition(t)})})},$.InitCodeValues=function(){$("#CodeValues").multiselect({includeSelectAllOption:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0})},$.AdjustEditCondition=function(t){$.InitCodeValues();var u=$("#editcondition").outerHeight(),r=n.position(),f=n.width();$("#editcondition").css({left:r.left,top:r.top+2,"min-width":f,"z-index":1041}),i.removeClass("hide"),n.animate({height:u},350),setTimeout(function(){$("#editcondition").slideDown(500,function(){$(this).scrollintoview(),t&&t.isnew&&$("#SelectCondition").click()})},10)},$.HideEditCondition=function(){var n,t;i.addClass("hide"),n=$("#editcondition").attr("originalheight"),$("#editcondition").slideUp(150),t=$("li[data-qid='"+$("#SelectedId").val()+"']"),t.animate({height:n},400)};$(document).on("click","#CancelChange",function(){return $.HideEditCondition(),!1});$("#conditions").on("mouseenter","header",function(){var n=$(this).closest("li");n.addClass("borderleftred")}).on("mouseleave","header",function(){var n=$(this).closest("li");n.removeClass("borderleftred")});$(document).on("click","#SaveCondition",function(){var n=$("#editForm").serialize();return $.post("/Query/SaveCondition/",n,function(n){n.startsWith("<form")?$("#editcondition .popover-content").html(n).ready(function(){$.InitCodeValues()}):($.HideEditCondition(),$("#conditions").html(n).ready(function(){RefreshList()}))}),!1});$("#conditions").on("change","select.changegroup",function(){var i=$(this).val(),t;return n=$(this).closest("li.condition"),t=n.data("qid"),$.post("/Query/ChangeGroup/"+t,{comparison:i},function(){RefreshList()}),!1});$("#conditions").on("click","a.addnewclause",function(){n=$(this).closest("li.condition");var i=n.data("qid");return $.post("/Query/AddNewCondition/"+i,{},function(i){$("#conditions").html(i).ready(function(){n=$("li[data-qid='"+$("#NewId").val()+"']"),t({isnew:!0})})}),!1});$("#conditions").on("click","a.addnewgroup",function(){n=$(this).closest("li.condition");var i=n.data("qid");return $.post("/Query/AddNewGroup/"+i,{},function(i){$("#conditions").html(i).ready(function(){n=$("li[data-qid='"+$("#NewId").val()+"']"),t({isnew:!0})})}),!1});$.ClipboardHasCondition&&$("li.pastecondition").show();$("#conditions").on("click","a.cutcondition",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $(this).parent().parent().prev().dropdown("toggle"),$.post("/Query/Cut/"+t),$("li.pastecondition").show(),!1});$("#conditions").on("click","a.copycondition",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $.post("/Query/Copy/"+t),$(this).parent().parent().prev().dropdown("toggle"),$("li.pastecondition").show(),!1});$("#conditions").on("click","a.pastecondition",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $.post("/Query/Paste/"+t,{},function(n){$("#conditions").html(n),RefreshList()}),!1});$("#conditions").on("click","a.insgroupabove",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $.post("/Query/InsGroupAbove/"+t,{},function(n){$("#conditions").html(n),RefreshList()}),!1});$("#conditions").on("click","a.delete",function(){n=$(this).closest("li.condition");var t=n.data("qid");return bootbox.confirm("Are you sure you want to delete?",function(n){n===!0&&$.post("/Query/RemoveCondition/"+t,null,function(n){$("#conditions").html(n),RefreshList()})}),!1});$(document).on("change","#Comparison",function(){if($("#CodesDiv").length>0){var n=$("#editForm").serialize();$.post("/Query/CodesDropdown",n,function(n){$("#CodesDiv").replaceWith(n).ready(function(){$("#CodeValues").multiselect()})})}});$("#Tags").click(function(){$("#TagsPopup").show()}),$(".datepicker").datepicker();$(document).on("change","#Program",function(){$.post("/Query/Divisions/"+$(this).val(),null,function(n){$("#Division").replaceWith(n),$("#Organization").replaceWith("<select id='Organization' name='Organization'><option value='0'>(not specified)<\/option><\/select>")})});$(document).on("change","#Division",function(){$.post("/Query/Organizations/"+$(this).val(),null,function(n){$("#Organization").replaceWith(n)})});$(document).on("click","#Run",function(){return RefreshList(),!1});$("#Export").click(function(){window.location="/Query/Export/"+$("#QueryId").val()});$(document).on("click","#SelectCondition",function(n){return n.preventDefault(),i.css({"z-index":1042}),$("#QueryConditionSelect").modal("show"),!1});$(document).on("hidden","#QueryConditionSelect",function(){i.css({"z-index":1040})});$(".FieldLink a").click(function(t){t.preventDefault();var i=n.data("qid");return $.post("/Query/SelectCondition/"+i,{conditionName:t.target.id},function(n){$("#QueryConditionSelect").modal("hide"),$("#editcondition .popover-content").html(n).ready($.AdjustEditCondition)}),!1}),$.navigate=function(n,t){n+=(n.match(/\?/)?"&":"?")+t,window.location=n},$("a.help").live("click",function(n){n.preventDefault();var t=$("#QueryConditionHelp");this.href.endsWith("-")?$("iframe",t).attr("src",this.href+$("#ConditionName").val()):$("iframe",t).attr("src",this.href),t.dialog("open")}),$("#NewSearchId").val()?(n=$("li[data-qid='"+$("#NewSearchId").val()+"']"),RefreshList(),t({isnew:!0})):$("#AutoRun").val()==="True"&&RefreshList(),RefreshList()});