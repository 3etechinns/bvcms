!function(a){if(typeof ko!="undefined"&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect){ko.bindingHandlers.multiselect={init:function(e,f,c,g,d){},update:function(e,g,c,h,d){var f=a(e).data("multiselect");if(!f){a(e).multiselect(ko.utils.unwrapObservable(g()))}else{if(c().options&&c().options().length!==f.originalOptions.length){f.updateOriginalOptions();a(e).multiselect("rebuild")}}}}}function b(e,d){this.options=this.getOptions(d);this.$select=a(e);this.originalOptions=this.$select.clone()[0].options;this.query="";this.searchTimeout=null;this.options.multiple=this.$select.attr("multiple")=="multiple";this.$container=a(this.options.buttonContainer).append('<button type="button" class="multiselect dropdown-toggle '+this.options.buttonClass+'" data-toggle="dropdown">'+this.options.buttonText(this.getSelected(),this.$select)+"</button>").append('<ul class="multiselect-container dropdown-menu'+(this.options.dropRight?" pull-right":"")+'"></ul>');if(this.options.buttonWidth){a("button",this.$container).css({width:this.options.buttonWidth})}var f=this.$select.attr("tabindex");if(f){a("button",this.$container).attr("tabindex",f)}if(this.options.maxHeight){a(".multiselect-container",this.$container).css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"})}if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var c=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);if(this.$select.find("option").length>=c){this.buildFilter()}}this.buildSelectAll();this.buildDropdown();this.updateButtonText();this.$select.hide().after(this.$container)}b.prototype={defaults:{buttonText:function(c,d){if(c.length==0){return this.nonSelectedText+' <b class="caret"></b>'}else{if(c.length>3){return c.length+" "+this.nSelectedText+' <b class="caret"></b>'}else{var e="";c.each(function(){var f=(a(this).attr("label")!==undefined)?a(this).attr("label"):a(this).html();e+=f+", "});return e.substr(0,e.length-2)+' <b class="caret"></b>'}}},buttonTitle:function(c,d){var e="";c.each(function(){e+=a(this).text()+", "});return e.substr(0,e.length-2)},onChange:function(d,c){},buttonClass:"btn",dropRight:false,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:false,includeSelectAllOption:false,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:false,enableCaseInsensitiveFiltering:false,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:false,nonSelectedText:"None selected",nSelectedText:"selected"},constructor:b,createOptionValue:function(e){if(a(e).is(":selected")){a(e).attr("selected","selected").prop("selected",true)}var g=a(e).attr("label")||a(e).html();var i=a(e).val();var f=this.options.multiple?"checkbox":"radio";var d=a('<li><a href="javascript:void(0);"><label class="'+f+'"><input type="'+f+'" /></label></a></li>');var h=a(e).prop("selected")||false;var c=a("input",d);c.val(i);if(i==this.options.selectAllValue){c.parent().parent().addClass("multiselect-all")}a("label",d).append(" "+g);a(".multiselect-container",this.$container).append(d);if(a(e).is(":disabled")){c.attr("disabled","disabled").prop("disabled",true).parents("li").addClass("disabled")}c.prop("checked",h);if(h&&this.options.selectedClass){c.parents("li").addClass(this.options.selectedClass)}},createOptgroup:function(d){var e=a(d).prop("label");var c=a('<li><label class="multiselect-group"></label></li>');a("label",c).text(e);a(".multiselect-container",this.$container).append(c);a("option",d).each(a.proxy(function(g,f){this.createOptionValue(f)},this))},toggleActiveState:function(){if(this.$select.attr("disabled")==undefined){a("button.multiselect.dropdown-toggle",this.$container).removeClass("disabled")}else{a("button.multiselect.dropdown-toggle",this.$container).addClass("disabled")}},buildSelectAll:function(){var c=this.$select[0][0]?this.$select[0][0].value==this.options.selectAllValue:false;if(this.options.includeSelectAllOption&&this.options.multiple&&!c){this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"</option>")}},buildDropdown:function(){this.toggleActiveState();this.$select.children().each(a.proxy(function(d,c){var e=a(c).prop("tagName").toLowerCase();if(e=="optgroup"){this.createOptgroup(c)}else{if(e=="option"){this.createOptionValue(c)}}},this));a(".multiselect-container li input",this.$container).on("change",a.proxy(function(g){var f=a(g.target).prop("checked")||false;var h=a(g.target).val()==this.options.selectAllValue;if(this.options.selectedClass){if(f){a(g.target).parents("li").addClass(this.options.selectedClass)}else{a(g.target).parents("li").removeClass(this.options.selectedClass)}}var d=a("option",this.$select).filter(function(){return a(this).val()==a(g.target).val()});var e=a("option",this.$select).not(d);var c=a("input",this.$container).not(a(g.target));if(h){c.filter(function(){return a(this).is(":checked")!=f}).trigger("click")}if(f){d.prop("selected",true);if(this.options.multiple){d.attr("selected","selected")}else{if(this.options.selectedClass){a(c).parents("li").removeClass(this.options.selectedClass)}a(c).prop("checked",false);e.removeAttr("selected").prop("selected",false);a(this.$container).find(".multiselect.dropdown-toggle").click()}if(this.options.selectedClass=="active"){e.parents("a").css("outline","")}}else{d.removeAttr("selected").prop("selected",false)}this.updateButtonText();this.options.onChange(d,f);this.$select.change();if(this.options.preventInputChangeEvent){return false}},this));a(".multiselect-container li a",this.$container).on("touchstart click",function(c){c.stopPropagation();a(c.target).blur()});this.$container.on("keydown",a.proxy(function(f){if(a('input[type="text"]',this.$container).is(":focus")){return}if((f.keyCode==9||f.keyCode==27)&&this.$container.hasClass("open")){a(this.$container).find(".multiselect.dropdown-toggle").click()}else{var e=a(this.$container).find("li:not(.divider):visible a");if(!e.length){return}var g=e.index(e.filter(":focus"));if(f.keyCode==38&&g>0){g--}else{if(f.keyCode==40&&g<e.length-1){g++}else{if(!~g){g=0}}}var d=e.eq(g);d.focus();if(this.options.selectedClass=="active"){d.css("outline","thin dotted #333").css("outline","5px auto -webkit-focus-ring-color");e.not(d).css("outline","")}if(f.keyCode==32||f.keyCode==13){var c=d.find("input");c.prop("checked",!c.prop("checked"));c.change()}f.stopPropagation();f.preventDefault()}},this))},buildFilter:function(){a(".multiselect-container",this.$container).prepend('<div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text" placeholder="'+this.options.filterPlaceholder+'"></div>');a(".multiselect-search",this.$container).val(this.query).on("click",function(c){c.stopPropagation()}).on("keydown",a.proxy(function(c){clearTimeout(this.searchTimeout);this.searchTimeout=this.asyncFunction(a.proxy(function(){if(this.query!=c.target.value){this.query=c.target.value;a.each(a(".multiselect-container li",this.$container),a.proxy(function(f,d){var i=a("input",d).val();if(i!=this.options.selectAllValue){var h=a("label",d).text();var i=a("input",d).val();if(i&&h&&i!=this.options.selectAllValue){var g=false;var e="";if((this.options.filterBehavior=="text"||this.options.filterBehavior=="both")){e=h}if((this.options.filterBehavior=="value"||this.options.filterBehavior=="both")){e=i}if(this.options.enableCaseInsensitiveFiltering&&e.toLowerCase().indexOf(this.query.toLowerCase())>-1){g=true}else{if(e.indexOf(this.query)>-1){g=true}}if(g){a(d).show()}else{a(d).hide()}}}},this))}},this),300,this)},this))},destroy:function(){this.$container.remove();this.$select.show()},refresh:function(){a("option",this.$select).each(a.proxy(function(e,d){var c=a(".multiselect-container li input",this.$container).filter(function(){return a(this).val()==a(d).val()});if(a(d).is(":selected")){c.prop("checked",true);if(this.options.selectedClass){c.parents("li").addClass(this.options.selectedClass)}}else{c.prop("checked",false);if(this.options.selectedClass){c.parents("li").removeClass(this.options.selectedClass)}}if(a(d).is(":disabled")){c.attr("disabled","disabled").prop("disabled",true).parents("li").addClass("disabled")}else{c.removeAttr("disabled").prop("disabled",false).parents("li").removeClass("disabled")}},this));this.updateButtonText()},select:function(f){if(f&&!a.isArray(f)){f=[f]}for(var e=0;e<f.length;e++){var g=f[e];var d=a("option",this.$select).filter(function(){return a(this).val()==g});var c=a(".multiselect-container li input",this.$container).filter(function(){return a(this).val()==g});if(this.options.selectedClass){c.parents("li").addClass(this.options.selectedClass)}c.prop("checked",true);d.attr("selected","selected").prop("selected",true);this.options.onChange(d,true)}this.updateButtonText()},deselect:function(e){if(e&&!a.isArray(e)){e=[e]}for(var f=0;f<e.length;f++){var g=e[f];var d=a("option",this.$select).filter(function(){return a(this).val()==g});var c=a(".multiselect-container li input",this.$container).filter(function(){return a(this).val()==g});if(this.options.selectedClass){c.parents("li").removeClass(this.options.selectedClass)}c.prop("checked",false);d.removeAttr("selected").prop("selected",false);this.options.onChange(d,false)}this.updateButtonText()},rebuild:function(){a(".multiselect-container",this.$container).html("");this.buildSelectAll();this.buildDropdown();this.updateButtonText();if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){this.buildFilter()}},dataprovider:function(c){var d="";c.forEach(function(e){d+='<option value="'+e.value+'">'+e.label+"</option>"});this.$select.html(d);this.rebuild()},getOptions:function(c){return a.extend({},this.defaults,c)},updateButtonText:function(){var c=this.getSelected();a("button",this.$container).html(this.options.buttonText(c,this.$select));a("button",this.$container).attr("title",this.options.buttonTitle(c,this.$select))},getSelected:function(){return a('option:selected[value!="'+this.options.selectAllValue+'"]',this.$select)},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(d,f,e){var c=Array.prototype.slice.call(arguments,3);return setTimeout(function(){d.apply(e||window,c)},f)}};a.fn.multiselect=function(c,d){return this.each(function(){var e=a(this).data("multiselect"),f=typeof c=="object"&&c;if(!e){a(this).data("multiselect",(e=new b(this,f)))}if(typeof c=="string"){e[c](d)}})};a.fn.multiselect.Constructor=b;a(function(){a("select[data-role=multiselect]").multiselect()})}(window.jQuery);/*
 * jQuery scrollintoview() plugin and :scrollable selector filter
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(a){var c={vertical:{x:false,y:true},horizontal:{x:true,y:false},both:{x:true,y:true},x:{x:true,y:false},y:{x:false,y:true}};var g={duration:"fast",direction:"both"};var e=/^(?:html)$/i;var b=function(i,k){k=k||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(i,null):i.currentStyle);var j=document.defaultView&&document.defaultView.getComputedStyle?true:false;var h={top:(parseFloat(j?k.borderTopWidth:a.css(i,"borderTopWidth"))||0),left:(parseFloat(j?k.borderLeftWidth:a.css(i,"borderLeftWidth"))||0),bottom:(parseFloat(j?k.borderBottomWidth:a.css(i,"borderBottomWidth"))||0),right:(parseFloat(j?k.borderRightWidth:a.css(i,"borderRightWidth"))||0)};return{top:h.top,left:h.left,bottom:h.bottom,right:h.right,vertical:h.top+h.bottom,horizontal:h.left+h.right}};var d=function(h){var j=a(window);var i=e.test(h[0].nodeName);return{border:i?{top:0,left:0,bottom:0,right:0}:b(h[0]),scroll:{top:(i?j:h).scrollTop(),left:(i?j:h).scrollLeft()},scrollbar:{right:i?0:h.innerWidth()-h[0].clientWidth,bottom:i?0:h.innerHeight()-h[0].clientHeight},rect:(function(){var k=h[0].getBoundingClientRect();return{top:i?0:k.top,left:i?0:k.left,bottom:i?h[0].clientHeight:k.bottom,right:i?h[0].clientWidth:k.right}})()}};a.fn.extend({scrollintoview:function(l){l=a.extend({},g,l);l.direction=c[typeof(l.direction)==="string"&&l.direction.toLowerCase()]||c.both;var j="";if(l.direction.x===true){j="horizontal"}if(l.direction.y===true){j=j?"both":"vertical"}var k=this.eq(0);var n=k.closest(":scrollable("+j+")");if(n.length>0){n=n.eq(0);var i={e:d(k),s:d(n)};var m={top:i.e.rect.top-(i.s.rect.top+i.s.border.top),bottom:i.s.rect.bottom-i.s.border.bottom-i.s.scrollbar.bottom-i.e.rect.bottom,left:i.e.rect.left-(i.s.rect.left+i.s.border.left),right:i.s.rect.right-i.s.border.right-i.s.scrollbar.right-i.e.rect.right};var h={};if(l.direction.y===true){if(m.top<0){h.scrollTop=i.s.scroll.top+m.top}else{if(m.top>0&&m.bottom<0){h.scrollTop=i.s.scroll.top+Math.min(m.top,-m.bottom)}}}if(l.direction.x===true){if(m.left<0){h.scrollLeft=i.s.scroll.left+m.left}else{if(m.left>0&&m.right<0){h.scrollLeft=i.s.scroll.left+Math.min(m.left,-m.right)}}}if(!a.isEmptyObject(h)){if(e.test(n[0].nodeName)){n=a("html,body")}n.animate(h,l.duration).eq(0).queue(function(o){a.isFunction(l.complete)&&l.complete.call(n[0]);o()})}else{a.isFunction(l.complete)&&l.complete.call(n[0])}}return this}});var f={auto:true,scroll:true,visible:false,hidden:false};a.extend(a.expr[":"],{scrollable:function(i,j,k,n){var h=c[typeof(k[3])==="string"&&k[3].toLowerCase()]||c.both;var o=(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(i,null):i.currentStyle);var l={x:f[o.overflowX.toLowerCase()]||false,y:f[o.overflowY.toLowerCase()]||false,isRoot:e.test(i.nodeName)};if(!l.x&&!l.y&&!l.isRoot){return false}var m={height:{scroll:i.scrollHeight,client:i.clientHeight},width:{scroll:i.scrollWidth,client:i.clientWidth},scrollableX:function(){return(l.x||l.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(l.y||l.isRoot)&&this.height.scroll>this.height.client}};return h.y&&m.scrollableY()||h.x&&m.scrollableX()}})})(jQuery);$(function(){$.postQuery=function(d,g,e){if($.isFunction(g)){e=g;g=undefined}if(g!==undefined){$("#SelectedId").val(g)}var f=$("#query-form").serialize();$.post("/Query/"+d,f,e)};var c;var a=$('<div class="modal-backdrop hide" />').appendTo("body");$("#conditions").on("click","a.edit-popover",function(){c=$(this).closest("li.condition");b();return false});var b=function(d){var e=c.data("qid");$("#editcondition").attr("originalheight",c.height());if($("#editcondition").is(":visible")){$.HideEditCondition()}$.postQuery("EditCondition",e,function(f){$("#editcondition .popover-content").html(f).ready(function(){$.AdjustEditCondition(d)})})};$("#Description").editable({placement:"right",showbuttons:"bottom",pk:1,url:"/Query/DescriptionUpdate",mode:"popup"});$("#CopyQuery").click(function(d){d.preventDefault();$.postQuery("CopyQuery",function(e){$("#Description").text(e)})});$("#DescriptionEdit").click(function(d){d.stopPropagation();$("#Description").editable("toggle")});$.AdjustEditCondition=function(e){$("#editcondition .date").datepicker({autoclose:true,orientation:"auto"});$("#editcondition select").multiselect({includeSelectAllOption:true,enableFiltering:true,enableCaseInsensitiveFiltering:true});var d=$("#editcondition").outerHeight();var f=c.position();var g=c.width();$("#editcondition").css({left:f.left,top:f.top+2,"min-width":g,"z-index":1041});a.removeClass("hide");c.animate({height:d},350);setTimeout(function(){$("#editcondition").slideDown(500,function(){$(this).scrollintoview();if(e&&e.isnew){$("#SelectCondition").click()}})},10)};$.HideEditCondition=function(){a.addClass("hide");var d=$("#editcondition").attr("originalheight");$("#editcondition").slideUp(150);var e=$("li[data-qid='"+$("#SelectedId").val()+"']");e.animate({height:d},400,function(){$("#editcondition .popover-content").empty()})};$("#CancelChange").live("click",function(){$.HideEditCondition();return false});$("#conditions header").live("mouseenter",function(){var d=$(this).closest("li");d.addClass("borderleftred")});$("#conditions header").live("mouseleave",function(){var d=$(this).closest("li");d.removeClass("borderleftred")});$("#SaveCondition").live("click",function(){$.postQuery("SaveCondition",function(d){if(d.startsWith("<fieldset")){$("#editcondition .popover-content").html(d).ready(function(){$.InitCodeValues()})}else{$.HideEditCondition();$("#conditions").html(d).ready(function(){RefreshList()})}});return false});$("#editForm input").live("keydown",function(d){if(d.keyCode==13){d.preventDefault();$("#SaveCondition").click();return false}});$("#conditions select.changegroup").live("change",function(){var e=$(this).val();c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("ChangeGroup/"+e,d,function(){RefreshList()});return false});$("#conditions a.addnewclause").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("AddNewCondition",d,function(e){$("#conditions").html(e).ready(function(){c=$("li[data-qid='"+$("#NewId").val()+"']");b({isnew:true})})});return false});$("#conditions a.addnewgroup").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("AddNewGroup",d,function(e){$("#conditions").html(e).ready(function(){c=$("li[data-qid='"+$("#NewId").val()+"']");b({isnew:true})})});return false});if($.ClipboardHasCondition){$("li.pastecondition").show()}$("#conditions a.cutcondition").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$(this).parent().parent().prev().dropdown("toggle");$.postQuery("Cut",d,function(e){$("#conditions").html(e).ready(function(){$("li.pastecondition").show();RefreshList()})});return false});$("#conditions a.copycondition").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("Copy",d);$(this).parent().parent().prev().dropdown("toggle");$("li.pastecondition").show();return false});$("#conditions a.pastecondition").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("Paste",d,function(e){$("#conditions").html(e);RefreshList()});return false});$("#conditions a.insgroupabove").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("InsGroupAbove",d,function(e){$("#conditions").html(e);RefreshList()});return false});$("#conditions a.maketopgroup").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");$.postQuery("MakeTopGroup",d,function(e){$("#conditions").html(e);RefreshList()});return false});$("#conditions a.delete").live("click",function(){c=$(this).closest("li.condition");var d=c.data("qid");bootbox.confirm("Are you sure you want to delete?",function(e){if(e===true){$.postQuery("RemoveCondition",d,function(f){$("#conditions").html(f);RefreshList()})}});return false});$("#Comparison").live("change",function(d){var e="#CodeValues";if($(e).length>0){$.postQuery("CodeSelect",function(f){$.replaceSelect("#CodeValues",f)})}});$("#Tags").click(function(d){$("#TagsPopup").show()});$.replaceSelect=function(e,d){$(e).multiselect("destroy").ready(function(){$(e).replaceWith(d).ready(function(){$(e).multiselect({enableFiltering:true,enableCaseInsensitiveFiltering:true})})})};$("#Program").live("change",function(d){$.postQuery("Divisions/"+$(this).val(),function(e){$.replaceSelect("#Division",e);$.replaceSelect("#Organization","<select id='Organization' name='Organization' style='display:none'><option value='0'>(not specified)</option></select>")})});$("#Division").live("change",function(){$.postQuery("Organizations/"+$(this).val(),function(d){$.replaceSelect("#Organization",d)})});$("#Run").live("click",function(d){RefreshList();return false});$("#Export").click(function(d){window.location="/Query/Export/"+$("#QueryId").val()});$("#SelectCondition").live("click",function(d){d.preventDefault();a.css({"z-index":1042});$("#QueryConditionSelect").modal("show");return false});$("#QueryConditionSelect").live("hidden",function(d){a.css({"z-index":1040})});$(".FieldLink a").click(function(d){d.preventDefault();var e=c.data("qid");$("#ConditionName").val(d.target.id);$.postQuery("SelectCondition",e,function(f){$("#QueryConditionSelect").modal("hide");$("#editcondition .popover-content").html(f).ready($.AdjustEditCondition)});return false});$.navigate=function(e,d){e+=(e.match(/\?/)?"&":"?")+d;window.location=e};$("a.help").live("click",function(f){f.preventDefault();var e=$("#QueryConditionHelp");if(this.href.endsWith("-")){$("iframe",e).attr("src",this.href+$("#ConditionName").val())}else{$("iframe",e).attr("src",this.href)}e.dialog("open")});if($("#NewSearchId").val()){c=$("li[data-qid='"+$("#NewSearchId").val()+"']");b({isnew:true})}else{if($("#AutoRun").val()==="True"){RefreshList()}}});function RefreshList(a){$.ajax({type:"POST",url:"/Query/Results/",data:a,timeout:1200000,success:function(b){$("#toolbar").show();$("#results").html(b);$("#people tbody tr:even").addClass("alt");$("a.taguntag").click(function(c){$.post("/Query/ToggleTag/"+$(this).attr("value"),function(d){if(d.error){alert(d.error)}else{$(c.target).text(d.HasTag?"Remove":"Add")}});return false});$("#people thead a.sortable").click(function(d){var e=$(this).text();var f=$("#Sort").val();$("#Sort").val(e);var c=$("#Direction").val();if(f==e&&c=="asc"){$("#Direction").val("desc")}else{$("#Direction").val("asc")}RefreshList();return false})},error:function(c,d,b){alert(b)}})}function ShowErrors(j){$(".validate").each(function(){$(this).next(".error").remove()});var e=eval("("+j+")");if(e.count==0){return false}$(".validate").each(function(){if(e[this.id]){$(this).after("<span class='error'> "+e[this.id]+"</span>")}});return true};