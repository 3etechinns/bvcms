function FadeList(){$("#results").addClass("faded-results")}function RefreshList(){var t=$("#query-form").serialize();$.ajax({type:"POST",url:"/Query/Results/",data:t,timeout:12e5,success:function(t){$("#toolbar").show(),$("#results").html(t),$("#results").removeClass("faded-results"),$("#people tbody tr:even").addClass("alt"),$("li.hideAlt").hide(),$("#people thead a.sortable").click(function(t){var e=$(this).text(),o=$("#Sort").val();$("#Sort").val(e);var i=$("#Direction").val();return o==e&&"asc"==i?$("#Direction").val("desc"):$("#Direction").val("asc"),RefreshList(),!1})},error:function(t,e,o){alert(o)}})}function ShowErrors(j){$(".validate").each(function(){$(this).next(".error").remove()});var e=eval("("+j+")");return 0==e.count?!1:($(".validate").each(function(){e[this.id]&&$(this).after("<span class='error'> "+e[this.id]+"</span>")}),!0)}!function(t){"use strict";function e(e,o){this.options=this.getOptions(o),this.$select=t(e),this.originalOptions=this.$select.clone()[0].options,this.query="",this.searchTimeout=null,this.options.multiple="multiple"==this.$select.attr("multiple"),this.$container=t(this.options.buttonContainer).append('<button type="button" class="multiselect dropdown-toggle '+this.options.buttonClass+'" data-toggle="dropdown">'+this.options.buttonText(this.getSelected(),this.$select)+"</button>").append('<ul class="multiselect-container dropdown-menu'+(this.options.dropRight?" pull-right":"")+'"></ul>'),this.options.buttonWidth&&t("button",this.$container).css({width:this.options.buttonWidth});var i=this.$select.attr("tabindex");if(i&&t("button",this.$container).attr("tabindex",i),this.options.maxHeight&&t(".multiselect-container",this.$container).css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"}),this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var n=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);this.$select.find("option").length>=n&&this.buildFilter()}this.buildSelectAll(),this.buildDropdown(),this.updateButtonText(),this.$select.hide().after(this.$container)}"undefined"!=typeof ko&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect&&(ko.bindingHandlers.multiselect={init:function(t,e,o,i,n){},update:function(e,o,i,n,s){var r=t(e).data("multiselect");r?i().options&&i().options().length!==r.originalOptions.length&&(r.updateOriginalOptions(),t(e).multiselect("rebuild")):t(e).multiselect(ko.utils.unwrapObservable(o()))}}),e.prototype={defaults:{buttonText:function(e,o){if(0==e.length)return this.nonSelectedText+' <b class="caret"></b>';if(e.length>3)return e.length+" "+this.nSelectedText+' <b class="caret"></b>';var i="";return e.each(function(){var e=void 0!==t(this).attr("label")?t(this).attr("label"):t(this).html();i+=e+", "}),i.substr(0,i.length-2)+' <b class="caret"></b>'},buttonTitle:function(e,o){var i="";return e.each(function(){i+=t(this).text()+", "}),i.substr(0,i.length-2)},onChange:function(t,e){},buttonClass:"btn",dropRight:!1,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1,includeSelectAllOption:!1,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:!1,enableCaseInsensitiveFiltering:!1,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:!1,nonSelectedText:"None selected",nSelectedText:"selected"},constructor:e,createOptionValue:function(e){t(e).is(":selected")&&t(e).attr("selected","selected").prop("selected",!0);var o=t(e).attr("label")||t(e).html(),i=t(e).val(),n=this.options.multiple?"checkbox":"radio",s=t('<li><a href="javascript:void(0);"><label class="'+n+'"><input type="'+n+'" /></label></a></li>'),r=t(e).prop("selected")||!1,a=t("input",s);a.val(i),i==this.options.selectAllValue&&a.parent().parent().addClass("multiselect-all"),t("label",s).append(" "+o),t(".multiselect-container",this.$container).append(s),t(e).is(":disabled")&&a.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"),a.prop("checked",r),r&&this.options.selectedClass&&a.parents("li").addClass(this.options.selectedClass)},createOptgroup:function(e){var o=t(e).prop("label"),i=t('<li><label class="multiselect-group"></label></li>');t("label",i).text(o),t(".multiselect-container",this.$container).append(i),t("option",e).each(t.proxy(function(t,e){this.createOptionValue(e)},this))},toggleActiveState:function(){void 0==this.$select.attr("disabled")?t("button.multiselect.dropdown-toggle",this.$container).removeClass("disabled"):t("button.multiselect.dropdown-toggle",this.$container).addClass("disabled")},buildSelectAll:function(){var t=this.$select[0][0]?this.$select[0][0].value==this.options.selectAllValue:!1;this.options.includeSelectAllOption&&this.options.multiple&&!t&&this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"</option>")},buildDropdown:function(){this.toggleActiveState(),this.$select.children().each(t.proxy(function(e,o){var i=t(o).prop("tagName").toLowerCase();"optgroup"==i?this.createOptgroup(o):"option"==i&&this.createOptionValue(o)},this)),t(".multiselect-container li input",this.$container).on("change",t.proxy(function(e){var o=t(e.target).prop("checked")||!1,i=t(e.target).val()==this.options.selectAllValue;this.options.selectedClass&&(o?t(e.target).parents("li").addClass(this.options.selectedClass):t(e.target).parents("li").removeClass(this.options.selectedClass));var n=t("option",this.$select).filter(function(){return t(this).val()==t(e.target).val()}),s=t("option",this.$select).not(n),r=t("input",this.$container).not(t(e.target));return i&&r.filter(function(){return t(this).is(":checked")!=o}).trigger("click"),o?(n.prop("selected",!0),this.options.multiple?n.attr("selected","selected"):(this.options.selectedClass&&t(r).parents("li").removeClass(this.options.selectedClass),t(r).prop("checked",!1),s.removeAttr("selected").prop("selected",!1),t(this.$container).find(".multiselect.dropdown-toggle").click()),"active"==this.options.selectedClass&&s.parents("a").css("outline","")):n.removeAttr("selected").prop("selected",!1),this.updateButtonText(),this.options.onChange(n,o),this.$select.change(),this.options.preventInputChangeEvent?!1:void 0},this)),t(".multiselect-container li a",this.$container).on("touchstart click",function(e){e.stopPropagation(),t(e.target).blur()}),this.$container.on("keydown",t.proxy(function(e){if(!t('input[type="text"]',this.$container).is(":focus"))if(9!=e.keyCode&&27!=e.keyCode||!this.$container.hasClass("open")){var o=t(this.$container).find("li:not(.divider):visible a");if(!o.length)return;var i=o.index(o.filter(":focus"));38==e.keyCode&&i>0?i--:40==e.keyCode&&i<o.length-1?i++:~i||(i=0);var n=o.eq(i);if(n.focus(),"active"==this.options.selectedClass&&(n.css("outline","thin dotted #333").css("outline","5px auto -webkit-focus-ring-color"),o.not(n).css("outline","")),32==e.keyCode||13==e.keyCode){var s=n.find("input");s.prop("checked",!s.prop("checked")),s.change()}e.stopPropagation(),e.preventDefault()}else t(this.$container).find(".multiselect.dropdown-toggle").click()},this))},buildFilter:function(){t(".multiselect-container",this.$container).prepend('<div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text" placeholder="'+this.options.filterPlaceholder+'"></div>'),t(".multiselect-search",this.$container).val(this.query).on("click",function(t){t.stopPropagation()}).on("keydown",t.proxy(function(e){clearTimeout(this.searchTimeout),this.searchTimeout=this.asyncFunction(t.proxy(function(){this.query!=e.target.value&&(this.query=e.target.value,t.each(t(".multiselect-container li",this.$container),t.proxy(function(e,o){var i=t("input",o).val();if(i!=this.options.selectAllValue){var n=t("label",o).text(),i=t("input",o).val();if(i&&n&&i!=this.options.selectAllValue){var s=!1,r="";("text"==this.options.filterBehavior||"both"==this.options.filterBehavior)&&(r=n),("value"==this.options.filterBehavior||"both"==this.options.filterBehavior)&&(r=i),this.options.enableCaseInsensitiveFiltering&&r.toLowerCase().indexOf(this.query.toLowerCase())>-1?s=!0:r.indexOf(this.query)>-1&&(s=!0),s?t(o).show():t(o).hide()}}},this)))},this),300,this)},this))},destroy:function(){this.$container.remove(),this.$select.show()},refresh:function(){t("option",this.$select).each(t.proxy(function(e,o){var i=t(".multiselect-container li input",this.$container).filter(function(){return t(this).val()==t(o).val()});t(o).is(":selected")?(i.prop("checked",!0),this.options.selectedClass&&i.parents("li").addClass(this.options.selectedClass)):(i.prop("checked",!1),this.options.selectedClass&&i.parents("li").removeClass(this.options.selectedClass)),t(o).is(":disabled")?i.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"):i.removeAttr("disabled").prop("disabled",!1).parents("li").removeClass("disabled")},this)),this.updateButtonText()},select:function(e){e&&!t.isArray(e)&&(e=[e]);for(var o=0;o<e.length;o++){var i=e[o],n=t("option",this.$select).filter(function(){return t(this).val()==i}),s=t(".multiselect-container li input",this.$container).filter(function(){return t(this).val()==i});this.options.selectedClass&&s.parents("li").addClass(this.options.selectedClass),s.prop("checked",!0),n.attr("selected","selected").prop("selected",!0),this.options.onChange(n,!0)}this.updateButtonText()},deselect:function(e){e&&!t.isArray(e)&&(e=[e]);for(var o=0;o<e.length;o++){var i=e[o],n=t("option",this.$select).filter(function(){return t(this).val()==i}),s=t(".multiselect-container li input",this.$container).filter(function(){return t(this).val()==i});this.options.selectedClass&&s.parents("li").removeClass(this.options.selectedClass),s.prop("checked",!1),n.removeAttr("selected").prop("selected",!1),this.options.onChange(n,!1)}this.updateButtonText()},rebuild:function(){t(".multiselect-container",this.$container).html(""),this.buildSelectAll(),this.buildDropdown(),this.updateButtonText(),(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering)&&this.buildFilter()},dataprovider:function(t){var e="";t.forEach(function(t){e+='<option value="'+t.value+'">'+t.label+"</option>"}),this.$select.html(e),this.rebuild()},getOptions:function(e){return t.extend({},this.defaults,e)},updateButtonText:function(){var e=this.getSelected();t("button",this.$container).html(this.options.buttonText(e,this.$select)),t("button",this.$container).attr("title",this.options.buttonTitle(e,this.$select))},getSelected:function(){return t('option:selected[value!="'+this.options.selectAllValue+'"]',this.$select)},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(t,e,o){var i=Array.prototype.slice.call(arguments,3);return setTimeout(function(){t.apply(o||window,i)},e)}},t.fn.multiselect=function(o,i){return this.each(function(){var n=t(this).data("multiselect"),s="object"==typeof o&&o;n||t(this).data("multiselect",n=new e(this,s)),"string"==typeof o&&n[o](i)})},t.fn.multiselect.Constructor=e,t(function(){t("select[data-role=multiselect]").multiselect()})}(window.jQuery),/*!
 * jQuery scrollintoview() plugin and :scrollable selector filter
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */
function(t){var e={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},o={duration:"fast",direction:"both"},i=/^(?:html)$/i,n=function(e,o){o=o||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle);var i=document.defaultView&&document.defaultView.getComputedStyle?!0:!1,n={top:parseFloat(i?o.borderTopWidth:t.css(e,"borderTopWidth"))||0,left:parseFloat(i?o.borderLeftWidth:t.css(e,"borderLeftWidth"))||0,bottom:parseFloat(i?o.borderBottomWidth:t.css(e,"borderBottomWidth"))||0,right:parseFloat(i?o.borderRightWidth:t.css(e,"borderRightWidth"))||0};return{top:n.top,left:n.left,bottom:n.bottom,right:n.right,vertical:n.top+n.bottom,horizontal:n.left+n.right}},s=function(e){var o=t(window),s=i.test(e[0].nodeName);return{border:s?{top:0,left:0,bottom:0,right:0}:n(e[0]),scroll:{top:(s?o:e).scrollTop(),left:(s?o:e).scrollLeft()},scrollbar:{right:s?0:e.innerWidth()-e[0].clientWidth,bottom:s?0:e.innerHeight()-e[0].clientHeight},rect:function(){var t=e[0].getBoundingClientRect();return{top:s?0:t.top,left:s?0:t.left,bottom:s?e[0].clientHeight:t.bottom,right:s?e[0].clientWidth:t.right}}()}};t.fn.extend({scrollintoview:function(n){n=t.extend({},o,n),n.direction=e["string"==typeof n.direction&&n.direction.toLowerCase()]||e.both;var r="";n.direction.x===!0&&(r="horizontal"),n.direction.y===!0&&(r=r?"both":"vertical");var a=this.eq(0),l=a.closest(":scrollable("+r+")");if(l.length>0){l=l.eq(0);var c={e:s(a),s:s(l)},u={top:c.e.rect.top-(c.s.rect.top+c.s.border.top),bottom:c.s.rect.bottom-c.s.border.bottom-c.s.scrollbar.bottom-c.e.rect.bottom,left:c.e.rect.left-(c.s.rect.left+c.s.border.left),right:c.s.rect.right-c.s.border.right-c.s.scrollbar.right-c.e.rect.right},d={};n.direction.y===!0&&(u.top<0?d.scrollTop=c.s.scroll.top+u.top:u.top>0&&u.bottom<0&&(d.scrollTop=c.s.scroll.top+Math.min(u.top,-u.bottom))),n.direction.x===!0&&(u.left<0?d.scrollLeft=c.s.scroll.left+u.left:u.left>0&&u.right<0&&(d.scrollLeft=c.s.scroll.left+Math.min(u.left,-u.right))),t.isEmptyObject(d)?t.isFunction(n.complete)&&n.complete.call(l[0]):(i.test(l[0].nodeName)&&(l=t("html,body")),l.animate(d,n.duration).eq(0).queue(function(e){t.isFunction(n.complete)&&n.complete.call(l[0]),e()}))}return this}});var r={auto:!0,scroll:!0,visible:!1,hidden:!1};t.extend(t.expr[":"],{scrollable:function(t,o,n,s){var a=e["string"==typeof n[3]&&n[3].toLowerCase()]||e.both,l=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle,c={x:r[l.overflowX.toLowerCase()]||!1,y:r[l.overflowY.toLowerCase()]||!1,isRoot:i.test(t.nodeName)};if(!c.x&&!c.y&&!c.isRoot)return!1;var u={height:{scroll:t.scrollHeight,client:t.clientHeight},width:{scroll:t.scrollWidth,client:t.clientWidth},scrollableX:function(){return(c.x||c.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(c.y||c.isRoot)&&this.height.scroll>this.height.client}};return a.y&&u.scrollableY()||a.x&&u.scrollableX()}})}(jQuery),$(function(){$.postQuery=function(t,e,o){$.isFunction(e)&&(o=e,e=void 0),void 0!==e&&$("#SelectedId").val(e);var i=$("#query-form").serialize();$.post("/Query/"+t,i,o)};var t,e=$('<div class="modal-backdrop hide" />').appendTo("body");$("#conditions").on("click","a.edit-popover",function(){return t=$(this).closest("li.condition"),o(),!1});var o=function(e){var o=t.data("qid");$("#editcondition").attr("originalheight",t.height()),$("#editcondition").is(":visible")&&$.HideEditCondition(),$.postQuery("EditCondition",o,function(t){$("#editcondition .popover-content").html(t).ready(function(){$.AdjustEditCondition(e)})})};$("#SaveAs").click(function(t){t.preventDefault();this.href;$("<div />").load("/Query/SaveAs",{id:$("#QueryId").val(),nametosaveas:$("#SaveToDescription").val()},function(){var t=$(this),e=t.find("form");e.modal("show"),e.on("hidden",function(){t.remove(),e.remove()})})}),$.AdjustEditCondition=function(o){$("#editcondition .dateonly").datepicker({keyboardNavigation:!0,orientation:"auto",minView:2,autoclose:!0,forceParse:!1}),$("#editcondition .datetime").datetimepicker({autoclose:!0,showMeridian:!0,orientation:"auto",format:$.dtoptions.formatTime,forceParse:!1}),$("#editcondition select").multiselect({includeSelectAllOption:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0});var i=$("#editcondition").outerHeight(),n=t.position(),s=t.width();$("#editcondition").css({left:n.left,top:n.top+2,"min-width":s,"z-index":1041}),e.removeClass("hide"),t.animate({height:i},350),setTimeout(function(){$("#editcondition").slideDown(500,function(){$(this).scrollintoview(),o&&o.isnew&&$("#SelectCondition").click()})},10)},$.HideEditCondition=function(){e.addClass("hide");var t=$("#editcondition").attr("originalheight");$("#editcondition").slideUp(150);var o=$("li[data-qid='"+$("#SelectedId").val()+"']");o.animate({height:t},400,function(){$("#editcondition .popover-content").empty()})},$("#CancelChange").live("click",function(){return $.HideEditCondition(),!1}),$("#conditions header").live("mouseenter",function(){var t=$(this).closest("li");t.addClass("borderleftred")}),$("#conditions header").live("mouseleave",function(){var t=$(this).closest("li");t.removeClass("borderleftred")}),$("#SaveCondition").live("click",function(){return $.postQuery("SaveCondition",function(t){t.startsWith("<fieldset")?$("#editcondition .popover-content").html(t).ready(function(){$.InitCodeValues()}):($.HideEditCondition(),$("#conditions").html(t).ready(function(){$("#AutoRun").prop("checked")?RefreshList():FadeList()}))}),!1}),$("#editForm input").live("keydown",function(t){return 13==t.keyCode?(t.preventDefault(),$("#SaveCondition").click(),!1):void 0}),$("#conditions select.changegroup").live("change",function(){var e=$(this).val();t=$(this).closest("li.condition");var o=t.data("qid");return $.postQuery("ChangeGroup/"+e,o,function(){$("#AutoRun").prop("checked")?RefreshList():FadeList()}),!1}),$("#conditions a.addnewclause").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $.postQuery("AddNewCondition",e,function(e){$("#conditions").html(e).ready(function(){t=$("li[data-qid='"+$("#NewId").val()+"']"),o({isnew:!0})})}),!1}),$("#conditions a.addnewgroup").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $.postQuery("AddNewGroup",e,function(e){$("#conditions").html(e).ready(function(){t=$("li[data-qid='"+$("#NewId").val()+"']"),o({isnew:!0})})}),!1}),$.ClipboardHasCondition&&$("li.pastecondition").show(),$("#conditions a.cutcondition").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $(this).parent().parent().prev().dropdown("toggle"),$.postQuery("Cut",e,function(t){$("#conditions").html(t).ready(function(){$("li.pastecondition").show(),$("#AutoRun").prop("checked")?RefreshList():FadeList()})}),!1}),$("#conditions a.copycondition").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $.postQuery("Copy",e),$(this).parent().parent().prev().dropdown("toggle"),$("li.pastecondition").show(),!1}),$("#conditions a.pastecondition").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $.postQuery("Paste",e,function(t){$("#conditions").html(t),$("#AutoRun").prop("checked")?RefreshList():FadeList()}),!1}),$("#conditions a.insgroupabove").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $.postQuery("InsGroupAbove",e,function(t){$("#conditions").html(t),$("#AutoRun").prop("checked")?RefreshList():FadeList()}),!1}),$("#conditions a.maketopgroup").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return $.postQuery("MakeTopGroup",e,function(t){$("#conditions").html(t),$("#AutoRun").prop("checked")?RefreshList():FadeList()}),!1}),$("#conditions a.delete").live("click",function(){t=$(this).closest("li.condition");var e=t.data("qid");return bootbox.confirm("Are you sure you want to delete?",function(t){t===!0&&$.postQuery("RemoveCondition",e,function(t){$("#conditions").html(t),$("#AutoRun").prop("checked")?RefreshList():FadeList()})}),!1}),$("#Comparison").live("change",function(t){var e="#CodeValues";$(e).length>0&&$.postQuery("CodeSelect",function(t){$.replaceSelect("#CodeValues",t)})}),$("#Tags").click(function(t){$("#TagsPopup").show()}),$.replaceSelect=function(t,e){$(t).multiselect("destroy").ready(function(){$(t).replaceWith(e).ready(function(){$(t).multiselect({enableFiltering:!0,enableCaseInsensitiveFiltering:!0})})})},$("#Program").live("change",function(t){$.postQuery("Divisions/"+$(this).val(),function(t){$.replaceSelect("#Division",t),$.replaceSelect("#Organization","<select id='Organization' name='Organization' style='display:none'><option value='0'>(not specified)</option></select>")})}),$("#Division").live("change",function(){$.postQuery("Organizations/"+$(this).val(),function(t){$.replaceSelect("#Organization",t)})}),$("#Run").live("click",function(t){return RefreshList(),!1}),$("#Export").click(function(t){window.location="/Query/Export/"+$("#QueryId").val()}),$("#SelectCondition").live("click",function(t){return t.preventDefault(),e.css({"z-index":1042}),$("#QueryConditionSelect").modal("show"),!1}),$("#QueryConditionSelect").live("hidden",function(t){e.css({"z-index":1040})}),$(".FieldLink a").click(function(e){e.preventDefault();var o=t.data("qid");return $("#ConditionName").val(e.target.id),$.postQuery("SelectCondition",o,function(t){$("#QueryConditionSelect").modal("hide"),$("#editcondition .popover-content").html(t).ready($.AdjustEditCondition)}),!1}),$.navigate=function(t,e){t+=(t.match(/\?/)?"&":"?")+e,window.location=t},$("#NewSearchId").val()?(t=$("li[data-qid='"+$("#NewSearchId").val()+"']"),o({isnew:!0})):$("#AutoRun").prop("checked")&&RefreshList(),$("#AutoRun").change(function(){$.post("/Query/SetAutoRun",{setting:$(this).prop("checked")})}),$("a.taguntag").live("click",function(t){return $.post("/Query/ToggleTag/"+$(this).attr("value"),function(e){e.error?alert(e.error):$(t.target).text(e.HasTag?"Remove":"Add")}),!1})}),function(t,e){var o=function(){var o,i=e(t.documentElement),n=e(t.body);return i.scrollTop()?i:(o=n.scrollTop(),n.scrollTop(o+1).scrollTop()==o?i:n.scrollTop(o))}();e.fn.smoothScroll=function(t){return t=~~t||400,this.find('a[href*="#"]').click(function(i){var n=this.hash,s=e(n);location.pathname.replace(/^\//,"")===this.pathname.replace(/^\//,"")&&location.hostname===this.hostname&&s.length&&(i.preventDefault(),o.stop().animate({scrollTop:s.offset().top},t,function(){location.hash=n}))}).end()}}(document,jQuery),function(t,e){var o,i;return i=e.document,o=function(){function o(o){this._options=t.extend({name:"tour",container:"body",keyboard:!0,storage:e.localStorage,debug:!1,backdrop:!1,redirect:!0,orphan:!1,duration:!1,basePath:"",template:"<div class='popover'>          <div class='arrow'></div>          <h3 class='popover-title'></h3>          <div class='popover-content'></div>          <div class='popover-navigation'>            <div class='btn-group'>              <button class='btn btn-sm btn-default' data-role='prev'>&laquo; Prev</button>              <button class='btn btn-sm btn-default' data-role='next'>Next &raquo;</button>              <button class='btn btn-sm btn-default' data-role='pause-resume'                data-pause-text='Pause'                data-resume-text='Resume'              >Pause</button>            </div>            <button class='btn btn-sm btn-default' data-role='end'>End tour</button>          </div>        </div>",afterSetState:function(t,e){},afterGetState:function(t,e){},afterRemoveState:function(t){},onStart:function(t){},onEnd:function(t){},onShow:function(t){},onShown:function(t){},onHide:function(t){},onHidden:function(t){},onNext:function(t){},onPrev:function(t){},onPause:function(t,e){},onResume:function(t,e){}},o),this._force=!1,this._inited=!1,this._steps=[],this.backdrop={overlay:null,$element:null,$background:null,backgroundShown:!1,overlayElementShown:!1}}return o.prototype.setState=function(t,e){var o,i;if(this._options.storage){i=""+this._options.name+"_"+t;try{this._options.storage.setItem(i,e)}catch(n){o=n,o.code===DOMException.QUOTA_EXCEEDED_ERR&&this.debug("LocalStorage quota exceeded. setState failed.")}return this._options.afterSetState(i,e)}return null==this._state&&(this._state={}),this._state[t]=e},o.prototype.removeState=function(t){var e;return this._options.storage?(e=""+this._options.name+"_"+t,this._options.storage.removeItem(e),this._options.afterRemoveState(e)):null!=this._state?delete this._state[t]:void 0},o.prototype.getState=function(t){var e,o;return this._options.storage?(e=""+this._options.name+"_"+t,o=this._options.storage.getItem(e)):null!=this._state&&(o=this._state[t]),(void 0===o||"null"===o)&&(o=null),this._options.afterGetState(t,o),o},o.prototype.addSteps=function(t){var e,o,i,n;for(n=[],o=0,i=t.length;i>o;o++)e=t[o],n.push(this.addStep(e));return n},o.prototype.addStep=function(t){return this._steps.push(t)},o.prototype.getStep=function(e){return null!=this._steps[e]?t.extend({id:"step-"+e,path:"",placement:"right",title:"",content:"<p></p>",next:e===this._steps.length-1?-1:e+1,prev:e-1,animation:!0,container:this._options.container,backdrop:this._options.backdrop,redirect:this._options.redirect,orphan:this._options.orphan,duration:this._options.duration,template:this._options.template,onShow:this._options.onShow,onShown:this._options.onShown,onHide:this._options.onHide,onHidden:this._options.onHidden,onNext:this._options.onNext,onPrev:this._options.onPrev,onPause:this._options.onPause,onResume:this._options.onResume},this._steps[e]):void 0},o.prototype.init=function(t){var e=this;return this._force=t,this.ended()?this._debug("Tour ended, init prevented."):(this.setCurrentStep(),this._setupMouseNavigation(),this._setupKeyboardNavigation(),this._onResize(function(){return e.showStep(e._current)}),null!==this._current&&this.showStep(this._current),this._inited=!0,this)},o.prototype.start=function(t){var e;return null==t&&(t=!1),this._inited||this.init(t),null===this._current?(e=this._makePromise(null!=this._options.onStart?this._options.onStart(this):void 0),this._callOnPromiseDone(e,this.showStep,0)):void 0},o.prototype.next=function(){var t;return this.ended()?this._debug("Tour ended, next prevented."):(t=this.hideStep(this._current),this._callOnPromiseDone(t,this._showNextStep))},o.prototype.prev=function(){var t;return this.ended()?this._debug("Tour ended, prev prevented."):(t=this.hideStep(this._current),this._callOnPromiseDone(t,this._showPrevStep))},o.prototype.goTo=function(t){var e;return this.ended()?this._debug("Tour ended, goTo prevented."):(e=this.hideStep(this._current),this._callOnPromiseDone(e,this.showStep,t))},o.prototype.end=function(){var o,n,s=this;return o=function(o){return t(i).off("click.tour-"+s._options.name),t(i).off("keyup.tour-"+s._options.name),t(e).off("resize.tour-"+s._options.name),s.setState("end","yes"),s._inited=!1,s._force=!1,s._clearTimer(),null!=s._options.onEnd?s._options.onEnd(s):void 0},n=this.hideStep(this._current),this._callOnPromiseDone(n,o)},o.prototype.ended=function(){return!this._force&&!!this.getState("end")},o.prototype.restart=function(){return this.removeState("current_step"),this.removeState("end"),this.setCurrentStep(0),this.start()},o.prototype.pause=function(){var t;return t=this.getStep(this._current),t&&t.duration?(this._paused=!0,this._duration-=(new Date).getTime()-this._start,e.clearTimeout(this._timer),this._debug("Paused/Stopped step "+(this._current+1)+" timer ("+this._duration+" remaining)."),null!=t.onPause?t.onPause(this,this._duration):void 0):void 0},o.prototype.resume=function(){var t,o=this;return t=this.getStep(this._current),t&&t.duration?(this._paused=!1,this._start=(new Date).getTime(),this._duration=this._duration||t.duration,this._timer=e.setTimeout(function(){return o._isLast()?o.next():o.end()},this._duration),this._debug("Started step "+(this._current+1)+" timer with duration "+this._duration),null!=t.onResume&&this._duration!==t.duration?t.onResume(this,this._duration):void 0):void 0},o.prototype.hideStep=function(e){var o,i,n,s=this;return(n=this.getStep(e))?(this._clearTimer(),i=this._makePromise(null!=n.onHide?n.onHide(this,e):void 0),o=function(e){var o;return o=t(n.element),o.data("bs.popover")||o.data("popover")||(o=t("body")),o.popover("destroy"),n.reflex&&o.css("cursor","").off("click.tour-"+s._options.name),n.backdrop&&s._hideBackdrop(),null!=n.onHidden?n.onHidden(s):void 0},this._callOnPromiseDone(i,o),i):void 0},o.prototype.showStep=function(e){var o,n,s,r,a=this;return(r=this.getStep(e))?(s=e<this._current,o=this._makePromise(null!=r.onShow?r.onShow(this,e):void 0),n=function(o){var n,l;if(a.setCurrentStep(e),l=t.isFunction(r.path)?r.path.call():a._options.basePath+r.path,n=[i.location.pathname,i.location.hash].join(""),a._isRedirect(l,n))return void a._redirect(r,l);if(a._isOrphan(r)){if(!r.orphan)return a._debug("Skip the orphan step "+(a._current+1)+". Orphan option is false and the element doesn't exist or is hidden."),void(s?a._showPrevStep():a._showNextStep());a._debug("Show the orphan step "+(a._current+1)+". Orphans option is true.")}return r.backdrop&&a._showBackdrop(a._isOrphan(r)?void 0:r.element),a._scrollIntoView(r.element,function(){return null!=r.element&&r.backdrop&&a._showOverlayElement(r.element),a._showPopover(r,e),null!=r.onShown&&r.onShown(a),a._debug("Step "+(a._current+1)+" of "+a._steps.length)}),r.duration?a.resume():void 0},this._callOnPromiseDone(o,n),o):void 0},o.prototype.setCurrentStep=function(t){return null!=t?(this._current=t,this.setState("current_step",t)):(this._current=this.getState("current_step"),this._current=null===this._current?null:parseInt(this._current,10)),this},o.prototype._showNextStep=function(){var t,e,o,i=this;return o=this.getStep(this._current),e=function(t){return i.showStep(o.next)},t=this._makePromise(null!=o.onNext?o.onNext(this):void 0),this._callOnPromiseDone(t,e)},o.prototype._showPrevStep=function(){var t,e,o,i=this;return o=this.getStep(this._current),e=function(t){return i.showStep(o.prev)},t=this._makePromise(null!=o.onPrev?o.onPrev(this):void 0),this._callOnPromiseDone(t,e)},o.prototype._debug=function(t){return this._options.debug?e.console.log("Bootstrap Tour '"+this._options.name+"' | "+t):void 0},o.prototype._isRedirect=function(t,e){return null!=t&&""!==t&&t.replace(/\?.*$/,"").replace(/\/?$/,"")!==e.replace(/\/?$/,"")},o.prototype._redirect=function(e,o){return t.isFunction(e.redirect)?e.redirect.call(this,o):e.redirect===!0?(this._debug("Redirect to "+o),i.location.href=o):void 0},o.prototype._isOrphan=function(e){return null==e.element||!t(e.element).length||t(e.element).is(":hidden")&&"http://www.w3.org/2000/svg"!==t(e.element)[0].namespaceURI},o.prototype._isLast=function(){return this._current<this._steps.length-1},o.prototype._showPopover=function(e,o){var i,n,s,r,a,l,c=this;return l=t.extend({},this._options),s=t(t.isFunction(e.template)?e.template(o,e):e.template),n=s.find(".popover-navigation"),a=this._isOrphan(e),a&&(e.element="body",e.placement="top",s=s.addClass("orphan")),i=t(e.element),s.addClass("tour-"+this._options.name),e.options&&t.extend(l,e.options),e.reflex&&i.css("cursor","pointer").on("click.tour-"+this._options.name,function(){return c._isLast()?c.next():c.end()}),e.prev<0&&n.find("*[data-role=prev]").addClass("disabled"),e.next<0&&n.find("*[data-role=next]").addClass("disabled"),e.duration||n.find("*[data-role='pause-resume']").remove(),e.template=s.clone().wrap("<div>").parent().html(),i.popover({placement:e.placement,trigger:"manual",title:e.title,content:e.content,html:!0,animation:e.animation,container:e.container,template:e.template,selector:e.element}).popover("show"),r=i.data("bs.popover")?i.data("bs.popover").tip():i.data("popover").tip(),r.attr("id",e.id),this._reposition(r,e),a?this._center(r):void 0},o.prototype._reposition=function(e,o){var n,s,r,a,l,c,u;if(a=e[0].offsetWidth,s=e[0].offsetHeight,u=e.offset(),l=u.left,c=u.top,n=t(i).outerHeight()-u.top-e.outerHeight(),0>n&&(u.top=u.top+n),r=t("html").outerWidth()-u.left-e.outerWidth(),0>r&&(u.left=u.left+r),u.top<0&&(u.top=0),u.left<0&&(u.left=0),e.offset(u),"bottom"===o.placement||"top"===o.placement){if(l!==u.left)return this._replaceArrow(e,2*(u.left-l),a,"left")}else if(c!==u.top)return this._replaceArrow(e,2*(u.top-c),s,"top")},o.prototype._center=function(o){return o.css("top",t(e).outerHeight()/2-o.outerHeight()/2)},o.prototype._replaceArrow=function(t,e,o,i){return t.find(".arrow").css(i,e?50*(1-e/o)+"%":"")},o.prototype._scrollIntoView=function(o,i){var n,s,r,a,l,c=this;return o?(n=t(o),s=t(e),r=n.offset().top,l=s.height(),a=Math.max(0,r-l/2),this._debug("Scroll into view. ScrollTop: "+a+". Element offset: "+r+". Window height: "+l+"."),t("body").stop().animate({scrollTop:Math.ceil(a)},function(){return i(),c._debug("Scroll into view. Animation end element offset: "+n.offset().top+". Window height: "+s.height()+".")})):i()},o.prototype._onResize=function(o,i){return t(e).on("resize.tour-"+this._options.name,function(){return clearTimeout(i),i=setTimeout(o,100)})},o.prototype._setupMouseNavigation=function(){var e=this;return e=this,t(i).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=next]:not(.disabled)").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=next]:not(.disabled)",function(t){return t.preventDefault(),e.next()}),t(i).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=prev]:not(.disabled)").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=prev]:not(.disabled)",function(t){return t.preventDefault(),e.prev()}),t(i).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=end]").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=end]",function(t){return t.preventDefault(),e.end()}),t(i).off("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=pause-resume]").on("click.tour-"+this._options.name,".popover.tour-"+this._options.name+" *[data-role=pause-resume]",function(o){var i;return o.preventDefault(),i=t(this),i.text(e._paused?i.data("pause-text"):i.data("resume-text")),e._paused?e.resume():e.pause()})},o.prototype._setupKeyboardNavigation=function(){var e=this;if(this._options.keyboard)return t(i).on("keyup.tour-"+this._options.name,function(t){if(t.which)switch(t.which){case 39:return t.preventDefault(),e._isLast()?e.next():e.end();case 37:if(t.preventDefault(),e._current>0)return e.prev();break;case 27:return t.preventDefault(),e.end()}})},o.prototype._makePromise=function(e){return e&&t.isFunction(e.then)?e:null},o.prototype._callOnPromiseDone=function(t,e,o){var i=this;return t?t.then(function(t){return e.call(i,o)}):e.call(this,o)},o.prototype._showBackdrop=function(e){return this.backdrop.backgroundShown?void 0:(this.backdrop=t("<div/>",{"class":"tour-backdrop"}),this.backdrop.backgroundShown=!0,t("body").append(this.backdrop))},o.prototype._hideBackdrop=function(){return this._hideOverlayElement(),this._hideBackground()},o.prototype._hideBackground=function(){return this.backdrop.remove(),this.backdrop.overlay=null,this.backdrop.backgroundShown=!1},o.prototype._showOverlayElement=function(e){var o,i,n;if(!this.backdrop.overlayElementShown)return this.backdrop.overlayElementShown=!0,i=t(e),o=t("<div/>"),n=i.offset(),n.top=n.top,n.left=n.left,o.width(i.innerWidth()).height(i.innerHeight()).addClass("tour-step-background").offset(n),i.addClass("tour-step-backdrop"),t("body").append(o),this.backdrop.$element=i,this.backdrop.$background=o},o.prototype._hideOverlayElement=function(){return this.backdrop.overlayElementShown?(this.backdrop.$element.removeClass("tour-step-backdrop"),this.backdrop.$background.remove(),this.backdrop.$element=null,this.backdrop.$background=null,this.backdrop.overlayElementShown=!1):void 0},o.prototype._clearTimer=function(){return e.clearTimeout(this._timer),this._timer=null,this._duration=null},o}(),e.Tour=o}(jQuery,window);