function RefreshList(n){$.ajax({type:"POST",url:"/Query/Results/",data:n,timeout:12e5,success:function(n){$("#toolbar").show(),$("#results").html(n),$("#people tbody tr:even").addClass("alt"),$("a.taguntag").click(function(n){return $.post("/Query/ToggleTag/"+$(this).attr("value"),null,function(t){t.error?alert(t.error):$(n.target).text(t.HasTag?"Remove":"Add")}),!1}),$("#people thead a.sortable").click(function(){var n=$(this).text(),i=$("#Sort").val(),t;return $("#Sort").val(n),t=$("#Direction").val(),i==n&&t=="asc"?$("#Direction").val("desc"):$("#Direction").val("asc"),RefreshList(),!1})},error:function(n,t,i){alert(i)}})}function ShowErrors(j){$(".validate").each(function(){$(this).next(".error").remove()});var e=eval("("+j+")");return e.count==0?!1:($(".validate").each(function(){e[this.id]&&$(this).after("<span class='error'> "+e[this.id]+"<\/span>")}),!0)}!function(n){"use strict";function t(t,i){this.options=this.getOptions(i),this.$select=n(t),this.originalOptions=this.$select.clone()[0].options,this.query="",this.searchTimeout=null,this.options.multiple=this.$select.attr("multiple")=="multiple",this.$container=n(this.options.buttonContainer).append('<button type="button" class="multiselect dropdown-toggle '+this.options.buttonClass+'" data-toggle="dropdown">'+this.options.buttonText(this.getSelected(),this.$select)+"<\/button>").append('<ul class="multiselect-container dropdown-menu'+(this.options.dropRight?" pull-right":"")+'"><\/ul>'),this.options.buttonWidth&&n("button",this.$container).css({width:this.options.buttonWidth});var r=this.$select.attr("tabindex");r&&n("button",this.$container).attr("tabindex",r),this.options.maxHeight&&n(".multiselect-container",this.$container).css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"}),(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering)&&this.buildFilter(),this.buildSelectAll(),this.buildDropdown(),this.updateButtonText(),this.$select.hide().after(this.$container)}typeof ko!="undefined"&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect&&(ko.bindingHandlers.multiselect={init:function(){},update:function(t,i,r){var u=n(t).data("multiselect");u?r().options&&r().options().length!==u.originalOptions.length&&(u.updateOriginalOptions(),n(t).multiselect("rebuild")):n(t).multiselect(ko.utils.unwrapObservable(i()))}}),t.prototype={defaults:{buttonText:function(t){if(t.length==0)return this.nonSelectedText+'<b class="caret"><\/b>';if(t.length>3)return t.length+" "+this.nSelectedText+' <b class="caret"><\/b>';var i="";return t.each(function(){var t=n(this).attr("label")!==undefined?n(this).attr("label"):n(this).html();i+=t+", "}),i.substr(0,i.length-2)+' <b class="caret"><\/b>'},buttonTitle:function(t){var i="";return t.each(function(){i+=n(this).text()+", "}),i.substr(0,i.length-2)},onChange:function(){},buttonClass:"btn",dropRight:!1,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1,includeSelectAllOption:!1,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:!1,enableCaseInsensitiveFiltering:!1,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:!1,nonSelectedText:"None selected",nSelectedText:"selected"},constructor:t,createOptionValue:function(t){n(t).is(":selected")&&n(t).attr("selected","selected").prop("selected",!0);var o=n(t).attr("label")||n(t).html(),u=n(t).val(),f=this.options.multiple?"checkbox":"radio",r=n('<li><a href="javascript:void(0);"><label class="'+f+'"><input type="'+f+'" /><\/label><\/a><\/li>'),e=n(t).prop("selected")||!1,i=n("input",r);i.val(u),u==this.options.selectAllValue&&i.parent().parent().addClass("multiselect-all"),n("label",r).append(" "+o),n(".multiselect-container",this.$container).append(r),n(t).is(":disabled")&&i.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"),i.prop("checked",e),e&&this.options.selectedClass&&i.parents("li").addClass(this.options.selectedClass)},toggleActiveState:function(){this.$select.attr("disabled")==undefined?n("button.multiselect.dropdown-toggle",this.$container).removeClass("disabled"):n("button.multiselect.dropdown-toggle",this.$container).addClass("disabled")},buildSelectAll:function(){var n=this.$select[0][0]?this.$select[0][0].value==this.options.selectAllValue:!1;this.options.includeSelectAllOption&&this.options.multiple&&!n&&this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"<\/option>")},buildDropdown:function(){this.toggleActiveState(),this.$select.children().each(n.proxy(function(t,i){var r=n(i).prop("tagName").toLowerCase();if(r=="optgroup"){var u=i,e=n(u).prop("label"),f=n('<li><label class="multiselect-group"><\/label><\/li>');n("label",f).text(e),n(".multiselect-container",this.$container).append(f),n("option",u).each(n.proxy(function(n,t){this.createOptionValue(t)},this))}else r=="option"&&this.createOptionValue(i)},this));n(".multiselect-container li input",this.$container).on("change",n.proxy(function(t){var r=n(t.target).prop("checked")||!1,e=n(t.target).val()==this.options.selectAllValue;this.options.selectedClass&&(r?n(t.target).parents("li").addClass(this.options.selectedClass):n(t.target).parents("li").removeClass(this.options.selectedClass));var i=n("option",this.$select).filter(function(){return n(this).val()==n(t.target).val()}),f=n("option",this.$select).not(i),u=n("input",this.$container).not(n(t.target));e&&u.filter(function(){return n(this).is(":checked")!=r}).trigger("click"),r?(i.prop("selected",!0),this.options.multiple?i.attr("selected","selected"):(this.options.selectedClass&&n(u).parents("li").removeClass(this.options.selectedClass),n(u).prop("checked",!1),f.removeAttr("selected").prop("selected",!1),n(this.$container).find(".multiselect.dropdown-toggle").click()),this.options.selectedClass=="active"&&f.parents("a").css("outline","")):i.removeAttr("selected").prop("selected",!1),this.updateButtonText();this.options.onChange(i,r);return this.$select.change(),this.options.preventInputChangeEvent?!1:void 0},this));n(".multiselect-container li a",this.$container).on("touchstart click",function(t){t.stopPropagation(),n(t.target).blur()});this.$container.on("keydown",n.proxy(function(t){var r,i,u,f;if(!n('input[type="text"]',this.$container).is(":focus"))if((t.keyCode==9||t.keyCode==27)&&this.$container.hasClass("open"))n(this.$container).find(".multiselect.dropdown-toggle").click();else{if(r=n(this.$container).find("li:not(.divider):visible a"),!r.length)return;i=r.index(r.filter(":focus")),t.keyCode==38&&i>0?i--:t.keyCode==40&&i<r.length-1?i++:~i||(i=0),u=r.eq(i),u.focus(),this.options.selectedClass=="active"&&(u.css("outline","thin dotted #333").css("outline","5px auto -webkit-focus-ring-color"),r.not(u).css("outline","")),(t.keyCode==32||t.keyCode==13)&&(f=u.find("input"),f.prop("checked",!f.prop("checked")),f.change()),t.stopPropagation(),t.preventDefault()}},this))},buildFilter:function(){n(".multiselect-container",this.$container).prepend('<div class="input-prepend"><span class="add-on"><i class="icon-search"><\/i><\/span><input class="multiselect-search" type="text" placeholder="'+this.options.filterPlaceholder+'"><\/div>');n(".multiselect-search",this.$container).val(this.query).on("click",function(n){n.stopPropagation()}).on("keydown",n.proxy(function(t){clearTimeout(this.searchTimeout),this.searchTimeout=this.asyncFunction(n.proxy(function(){this.query!=t.target.value&&(this.query=t.target.value,n.each(n(".multiselect-container li",this.$container),n.proxy(function(t,i){var r=n("input",i).val(),e,f,u;r!=this.options.selectAllValue&&(e=n("label",i).text(),r=n("input",i).val(),r&&e&&r!=this.options.selectAllValue&&(f=!1,u="",(this.options.filterBehavior=="text"||this.options.filterBehavior=="both")&&(u=e),(this.options.filterBehavior=="value"||this.options.filterBehavior=="both")&&(u=r),this.options.enableCaseInsensitiveFiltering&&u.toLowerCase().indexOf(this.query.toLowerCase())>-1?f=!0:u.indexOf(this.query)>-1&&(f=!0),f?n(i).show():n(i).hide()))},this)))},this),300,this)},this))},destroy:function(){this.$container.remove(),this.$select.show()},refresh:function(){n("option",this.$select).each(n.proxy(function(t,i){var r=n(".multiselect-container li input",this.$container).filter(function(){return n(this).val()==n(i).val()});n(i).is(":selected")?(r.prop("checked",!0),this.options.selectedClass&&r.parents("li").addClass(this.options.selectedClass)):(r.prop("checked",!1),this.options.selectedClass&&r.parents("li").removeClass(this.options.selectedClass)),n(i).is(":disabled")?r.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"):r.removeAttr("disabled").prop("disabled",!1).parents("li").removeClass("disabled")},this)),this.updateButtonText()},select:function(t){var i=n("option",this.$select).filter(function(){return n(this).val()==t}),r=n(".multiselect-container li input",this.$container).filter(function(){return n(this).val()==t});this.options.selectedClass&&r.parents("li").addClass(this.options.selectedClass),r.prop("checked",!0),i.attr("selected","selected").prop("selected",!0),this.updateButtonText();this.options.onChange(i,!0)},deselect:function(t){var i=n("option",this.$select).filter(function(){return n(this).val()==t}),r=n(".multiselect-container li input",this.$container).filter(function(){return n(this).val()==t});this.options.selectedClass&&r.parents("li").removeClass(this.options.selectedClass),r.prop("checked",!1),i.removeAttr("selected").prop("selected",!1),this.updateButtonText();this.options.onChange(i,!1)},rebuild:function(){n(".multiselect-container",this.$container).html(""),this.buildDropdown(this.$select,this.options),this.updateButtonText(),(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering)&&this.buildFilter()},getOptions:function(t){return n.extend({},this.defaults,t)},updateButtonText:function(){var t=this.getSelected();n("button",this.$container).html(this.options.buttonText(t,this.$select)),n("button",this.$container).attr("title",this.options.buttonTitle(t,this.$select))},getSelected:function(){return n('option:selected[value!="'+this.options.selectAllValue+'"]',this.$select)},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(n,t,i){var r=Array.prototype.slice.call(arguments,3);return setTimeout(function(){n.apply(i||window,r)},t)}},n.fn.multiselect=function(i,r){return this.each(function(){var u=n(this).data("multiselect"),f=typeof i=="object"&&i;u||n(this).data("multiselect",u=new t(this,f)),typeof i=="string"&&u[i](r)})},n.fn.multiselect.Constructor=t,n(function(){n("select[data-role=multiselect]").multiselect()})}(window.jQuery),function(n){var t={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},f={duration:"fast",direction:"both"},i=/^(?:html)$/i,e=function(t,i){i=i||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle);var u=document.defaultView&&document.defaultView.getComputedStyle?!0:!1,r={top:parseFloat(u?i.borderTopWidth:n.css(t,"borderTopWidth"))||0,left:parseFloat(u?i.borderLeftWidth:n.css(t,"borderLeftWidth"))||0,bottom:parseFloat(u?i.borderBottomWidth:n.css(t,"borderBottomWidth"))||0,right:parseFloat(u?i.borderRightWidth:n.css(t,"borderRightWidth"))||0};return{top:r.top,left:r.left,bottom:r.bottom,right:r.right,vertical:r.top+r.bottom,horizontal:r.left+r.right}},u=function(t){var u=n(window),r=i.test(t[0].nodeName);return{border:r?{top:0,left:0,bottom:0,right:0}:e(t[0]),scroll:{top:(r?u:t).scrollTop(),left:(r?u:t).scrollLeft()},scrollbar:{right:r?0:t.innerWidth()-t[0].clientWidth,bottom:r?0:t.innerHeight()-t[0].clientHeight},rect:function(){var n=t[0].getBoundingClientRect();return{top:r?0:n.top,left:r?0:n.left,bottom:r?t[0].clientHeight:n.bottom,right:r?t[0].clientWidth:n.right}}()}},r;n.fn.extend({scrollintoview:function(r){var c,l,s;if(r=n.extend({},f,r),r.direction=t[typeof r.direction=="string"&&r.direction.toLowerCase()]||t.both,c="",r.direction.x===!0&&(c="horizontal"),r.direction.y===!0&&(c=c?"both":"vertical"),l=this.eq(0),s=l.closest(":scrollable("+c+")"),s.length>0){s=s.eq(0);var e={e:u(l),s:u(s)},o={top:e.e.rect.top-(e.s.rect.top+e.s.border.top),bottom:e.s.rect.bottom-e.s.border.bottom-e.s.scrollbar.bottom-e.e.rect.bottom,left:e.e.rect.left-(e.s.rect.left+e.s.border.left),right:e.s.rect.right-e.s.border.right-e.s.scrollbar.right-e.e.rect.right},h={};r.direction.y===!0&&(o.top<0?h.scrollTop=e.s.scroll.top+o.top:o.top>0&&o.bottom<0&&(h.scrollTop=e.s.scroll.top+Math.min(o.top,-o.bottom))),r.direction.x===!0&&(o.left<0?h.scrollLeft=e.s.scroll.left+o.left:o.left>0&&o.right<0&&(h.scrollLeft=e.s.scroll.left+Math.min(o.left,-o.right))),n.isEmptyObject(h)?n.isFunction(r.complete)&&r.complete.call(s[0]):(i.test(s[0].nodeName)&&(s=n("html,body")),s.animate(h,r.duration).eq(0).queue(function(t){n.isFunction(r.complete)&&r.complete.call(s[0]),t()}))}return this}}),r={auto:!0,scroll:!0,visible:!1,hidden:!1},n.extend(n.expr[":"],{scrollable:function(n,u,f){var s=t[typeof f[3]=="string"&&f[3].toLowerCase()]||t.both,h=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(n,null):n.currentStyle,e={x:r[h.overflowX.toLowerCase()]||!1,y:r[h.overflowY.toLowerCase()]||!1,isRoot:i.test(n.nodeName)},o;return!e.x&&!e.y&&!e.isRoot?!1:(o={height:{scroll:n.scrollHeight,client:n.clientHeight},width:{scroll:n.scrollWidth,client:n.clientWidth},scrollableX:function(){return(e.x||e.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(e.y||e.isRoot)&&this.height.scroll>this.height.client}},s.y&&o.scrollableY()||s.x&&o.scrollableX())}})}(jQuery),$(function(){var n,i=$('<div class="modal-backdrop hide" />').appendTo("body"),t;$("#conditions").on("click","a.edit-popover",function(){return n=$(this).closest("li.condition"),t(),!1});t=function(t){var i=n.data("qid");$("#editcondition").attr("originalheight",n.height()),$("#editcondition").is(":visible")&&$.HideEditCondition(),$.post("/Query/EditCondition/"+i,null,function(n){$("#editcondition .popover-content").html(n).ready(function(){$.AdjustEditCondition(t)})})},$("#Description").editable({placement:"right",showbuttons:"bottom",pk:1,url:"/Query/DescriptionUpdate",mode:"popup"}),$("#DescriptionEdit").click(function(n){n.stopPropagation(),$("#Description").editable("toggle")}),$.InitCodeValues=function(){$("#CodeValues").multiselect({includeSelectAllOption:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0})},$.AdjustEditCondition=function(t){$.InitCodeValues();var u=$("#editcondition").outerHeight(),r=n.position(),f=n.width();$("#editcondition").css({left:r.left,top:r.top+2,"min-width":f,"z-index":1041}),i.removeClass("hide"),n.animate({height:u},350),setTimeout(function(){$("#editcondition").slideDown(500,function(){$(this).scrollintoview(),t&&t.isnew&&$("#SelectCondition").click()})},10)},$.HideEditCondition=function(){var n,t;i.addClass("hide"),n=$("#editcondition").attr("originalheight"),$("#editcondition").slideUp(150),t=$("li[data-qid='"+$("#SelectedId").val()+"']"),t.animate({height:n},400)};$(document).on("click","#CancelChange",function(){return $.HideEditCondition(),!1});$("#conditions").on("mouseenter","header",function(){var n=$(this).closest("li");n.addClass("borderleftred")}).on("mouseleave","header",function(){var n=$(this).closest("li");n.removeClass("borderleftred")});$(document).on("click","#SaveCondition",function(){var n=$("#editForm").serialize();return $.post("/Query/SaveCondition/",n,function(n){n.startsWith("<form")?$("#editcondition .popover-content").html(n).ready(function(){$.InitCodeValues()}):($.HideEditCondition(),$("#conditions").html(n).ready(function(){RefreshList()}))}),!1});$(document).on("keydown","#editForm input",function(n){if(n.keyCode==13)return n.preventDefault(),$("#SaveCondition").click(),!1});$("#conditions").on("change","select.changegroup",function(){var i=$(this).val(),t;return n=$(this).closest("li.condition"),t=n.data("qid"),$.post("/Query/ChangeGroup/"+t,{comparison:i},function(){RefreshList()}),!1});$("#conditions").on("click","a.addnewclause",function(){n=$(this).closest("li.condition");var i=n.data("qid");return $.post("/Query/AddNewCondition/"+i,{},function(i){$("#conditions").html(i).ready(function(){n=$("li[data-qid='"+$("#NewId").val()+"']"),t({isnew:!0})})}),!1});$("#conditions").on("click","a.addnewgroup",function(){n=$(this).closest("li.condition");var i=n.data("qid");return $.post("/Query/AddNewGroup/"+i,{},function(i){$("#conditions").html(i).ready(function(){n=$("li[data-qid='"+$("#NewId").val()+"']"),t({isnew:!0})})}),!1});$.ClipboardHasCondition&&$("li.pastecondition").show();$("#conditions").on("click","a.cutcondition",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $(this).parent().parent().prev().dropdown("toggle"),$.post("/Query/Cut/"+t),$("li.pastecondition").show(),!1});$("#conditions").on("click","a.copycondition",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $.post("/Query/Copy/"+t),$(this).parent().parent().prev().dropdown("toggle"),$("li.pastecondition").show(),!1});$("#conditions").on("click","a.pastecondition",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $.post("/Query/Paste/"+t,{},function(n){$("#conditions").html(n),RefreshList()}),!1});$("#conditions").on("click","a.insgroupabove",function(){n=$(this).closest("li.condition");var t=n.data("qid");return $.post("/Query/InsGroupAbove/"+t,{},function(n){$("#conditions").html(n),RefreshList()}),!1});$("#conditions").on("click","a.delete",function(){n=$(this).closest("li.condition");var t=n.data("qid");return bootbox.confirm("Are you sure you want to delete?",function(n){n===!0&&$.post("/Query/RemoveCondition/"+t,null,function(n){$("#conditions").html(n),RefreshList()})}),!1});$(document).on("change","#Comparison",function(){if($("#CodesDiv").length>0){var n=$("#editForm").serialize();$.post("/Query/CodesDropdown",n,function(n){$("#CodesDiv").replaceWith(n).ready(function(){$("#CodeValues").multiselect()})})}});$("#Tags").click(function(){$("#TagsPopup").show()}),$(".datepicker").datepicker();$(document).on("change","#Program",function(){$.post("/Query/Divisions/"+$(this).val(),null,function(n){$("#Division").replaceWith(n),$("#Organization").replaceWith("<select id='Organization' name='Organization'><option value='0'>(not specified)<\/option><\/select>")})});$(document).on("change","#Division",function(){$.post("/Query/Organizations/"+$(this).val(),null,function(n){$("#Organization").replaceWith(n)})});$(document).on("click","#Run",function(){return RefreshList(),!1});$("#Export").click(function(){window.location="/Query/Export/"+$("#QueryId").val()});$(document).on("click","#SelectCondition",function(n){return n.preventDefault(),i.css({"z-index":1042}),$("#QueryConditionSelect").modal("show"),!1});$(document).on("hidden","#QueryConditionSelect",function(){i.css({"z-index":1040})});$(".FieldLink a").click(function(t){t.preventDefault();var i=n.data("qid");return $.post("/Query/SelectCondition/"+i,{conditionName:t.target.id},function(n){$("#QueryConditionSelect").modal("hide"),$("#editcondition .popover-content").html(n).ready($.AdjustEditCondition)}),!1}),$.navigate=function(n,t){n+=(n.match(/\?/)?"&":"?")+t,window.location=n},$("a.help").live("click",function(n){n.preventDefault();var t=$("#QueryConditionHelp");this.href.endsWith("-")?$("iframe",t).attr("src",this.href+$("#ConditionName").val()):$("iframe",t).attr("src",this.href),t.dialog("open")}),$("#NewSearchId").val()?(n=$("li[data-qid='"+$("#NewSearchId").val()+"']"),t({isnew:!0})):$("#AutoRun").val()==="True"&&RefreshList()});